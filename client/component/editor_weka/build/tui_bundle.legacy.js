!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="SIrR")}({"+MEP":function(e,t){e.exports=tui.require("tui/components/profile/MiniProfileCard")},"+pLW":function(e,t){e.exports=tui.require("editor_weka/components/suggestion/User")},"+xcZ":function(e,t){e.exports=tui.require("editor_weka/components/attachments/FileAttachment")},"/+gN":function(e,t){e.exports=tui.require("tui/components/icons/TextItalic")},"/7YT":function(e,t){e.exports=tui.require("ext_prosemirror/model")},"/uQ1":function(e,t,n){"use strict";n.r(t),n.d(t,"toggleList",(function(){return o})),n.d(t,"isListActive",(function(){return a}));var i=n("YVua"),r=n("D7iR");n("/7YT"),n("GcJT");function o(e,t,n){var o=Object(i.liftListItem)(t),a=Object(i.wrapInList)(e);return function(t,i,s){var u=t.selection,c=u.$from.blockRange(u.$to);if(!c)return!1;var l=function(e,t){return Object(r.findParentNode)((function(e){return t.includes(e.type)}))(e)}(u,n),d=l&&c.depth-l.depth<=1;if(c.depth>=1&&d){if(l.node.type===e)return o(t,i,s);if(e.validContent(l.node.content))return i&&i(t.tr.setNodeMarkup(l.pos,e)),!0}return a(t,i,s)}}function a(e,t){var n=e.selection,i=n.$from.blockRange(n.$to);if(!i)return!1;var o=Object(r.findParentNode)((function(e){return e.type==t}))(n);return i.depth>=1&&o&&i.depth-o.depth<=1}},"00Pk":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AudioBlock")},"0QOp":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/LinkBlock")},"0oIn":function(e,t,n){"use strict";n.r(t);var i=n("5h9J"),r={components:{ButtonIcon:n.n(i).a},props:{text:{type:String,required:!0},selected:{type:Boolean,default:null},iconOnly:Boolean,disabled:Boolean},computed:{ariaPressed:function(){return null!=this.selected&&(this.selected?"true":"false")}}},o=(n("wC1v"),n("KHd+")),a=Object(o.a)(r,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("ButtonIcon",{staticClass:"tui-wekaToolbarButtonIcon",class:{"tui-wekaToolbarButtonIcon--selected":e.selected,"tui-wekaToolbarButtonIcon--iconOnly":e.iconOnly},attrs:{"aria-label":e.text,"aria-pressed":e.ariaPressed,title:e.text,disabled:e.disabled},on:{click:function(t){return e.$emit("click",t)}}},[e._t("icon")],2)}),[],!1,null,null,null);a.options.__hasBlocks={script:!0,template:!0};t.default=a.exports},"12HA":function(e,t){e.exports=tui.require("tui/config")},"1egj":function(e,t,n){"use strict";n.r(t),n.d(t,"getMarkRange",(function(){return s})),n.d(t,"expandContentResolvedRange",(function(){return u})),n.d(t,"getMark",(function(){return c})),n.d(t,"ResolvedRange",(function(){return l}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o);function s(e,t){var n=d(e);if(!n.node)return!1;var i=n.node.marks.find((function(e){return e.type===t}));if(!i)return!1;var r=e.index(),o=e.start()+n.offset,a=o+n.node.nodeSize;return{from:f(e.parent,i,r,o,-1),to:f(e.parent,i,r,a,1)}}function u(e){if(e&&e.$from.parent!=e.$from.doc&&e.$from.sameParent(e.$to)&&0===e.$from.parentOffset&&e.$to.parentOffset===e.$to.parent.nodeSize-2){var t=e.$from.doc;return new l(t.resolve(e.$from.pos-1),t.resolve(e.$to.pos+1))}return e}function c(e,t){return d(e).node.marks.find((function(e){return e.type===t}))}var l=function(){function e(t,n){r()(this,e),this.$from=t,this.$to=n}return a()(e,null,[{key:"resolve",value:function(t,n){return new e(t.resolve(n.from),t.resolve(n.to))}}]),e}();function d(e){return e.parent.childAfter(e.parentOffset)}function f(e,t,n,i,r){for(var o=e.childCount-1;!((n+=r)<0||n>o);){var a=e.child(n);if(!t.isInSet(a.marks))break;i+=e.child(n).nodeSize*r}return i}},"1mLp":function(e,t,n){"use strict";n.r(t);var i=n("gLvT"),r=n.n(i),o=n("KGcv"),a=n.n(o),s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"core_find_hashtags"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pattern"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contextid"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"hashtags"},name:{kind:"Name",value:"core_hashtags_by_pattern"},arguments:[{kind:"Argument",name:{kind:"Name",value:"pattern"},value:{kind:"Variable",name:{kind:"Name",value:"pattern"}}},{kind:"Argument",name:{kind:"Name",value:"contextid"},value:{kind:"Variable",name:{kind:"Name",value:"contextid"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tag"},arguments:[],directives:[]}]}}]}}]},u={components:{Dropdown:r.a,DropdownItem:a.a},props:{contextId:{type:[Number,String]},component:{type:String},area:{type:String},location:{required:!0,type:Object},pattern:{required:!0,type:String}},data:function(){return{hashtags:[]}},apollo:{hashtags:{query:s,fetchPolicy:"network-only",variables:function(){return{pattern:this.pattern,contextid:this.contextId,component:this.component,area:this.area}}}},computed:{showSuggestions:function(){return this.$apollo.loading||this.hashtags.length>0},positionStyle:function(){return{left:"".concat(this.location.x,"px"),top:"".concat(this.location.y,"px")}}},watch:{showSuggestions:function(e){e||this.$emit("dismiss")}},mounted:function(){var e=this.$refs.customTrigger;e&&e.click()},methods:{pickTag:function(e){var t=e.id,n=e.tag;this.$emit("item-selected",{id:t,text:n})},dismiss:function(){this.open=!1,this.$emit("dismiss")}}},c=(n("5kVk"),n("KHd+")),l=function(e){e.options.__langStrings={editor_weka:["matching_hashtags"],core:["loadinghelp"]}},d=Object(c.a)(u,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaHashtagSuggestions",style:e.positionStyle},[n("Dropdown",{attrs:{separator:!1,open:e.showSuggestions,"inline-menu":!0},on:{dismiss:e.dismiss},scopedSlots:e._u([{key:"trigger",fn:function(){return[n("span",{staticClass:"sr-only"},[e._v("\n        "+e._s(e.$str("matching_hashtags","editor_weka"))+":\n      ")])]},proxy:!0}])},[e._v(" "),e.$apollo.loading?[n("DropdownItem",{attrs:{disabled:!0}},[e._v("\n        "+e._s(e.$str("loadinghelp","core"))+"\n      ")])]:e._e(),e._v(" "),e._l(e.hashtags,(function(t,i){return n("DropdownItem",{key:i,on:{click:function(n){return e.pickTag(t)}}},[e._v("\n      "+e._s(t.tag)+"\n    ")])}))],2)],1)}),[],!1,null,null,null);"function"==typeof l&&l(d),d.options.__hasBlocks={script:!0,template:!0};t.default=d.exports},"22E+":function(e,t){e.exports=tui.require("ext_prosemirror/view")},"2RJX":function(e,t){e.exports=tui.require("tui/components/icons/Attachment")},"2wx7":function(e,t){e.exports=tui.require("editor_weka/components/Weka")},"36rR":function(e,t){e.exports=tui.require("tui/dom/focus")},"3bgQ":function(e,t){e.exports=tui.require("tui/components/embeds/ResponsiveEmbedIframe")},"3qPy":function(e,t){e.exports=tui.require("tui/components/icons/ListOrdered")},"3sQR":function(e,t){e.exports=tui.require("tui/components/dropdown/DropdownButton")},"4BOM":function(e,t){},"4uRO":function(e,t,n){"use strict";n.r(t);var i=n("GcJT"),r=n("EBtw"),o=n.n(r),a=n("TnOg");t.default=function(e){var t=new i.PluginKey("hashtags"),n=new a.default(e),r=n.resetComponent(),s=new RegExp("#[A-Za-z0-9]+$","g"),u=function(e){var t=n.getNode(e.state,"hashtag",{text:r.text.slice(1)});n.convertToNode(r,t),r=n.resetComponent()};return new i.Plugin({key:t,view:function(){var e=this;return{update:function(t){var i=e.key.getState(t.state),a=i.text,s=i.active,u=i.range;n.destroyInstance(),a&&s&&n.showList({view:t,component:{name:"hashtag",component:o.a,attrs:function(e,t){return{text:t}}},state:{text:a.slice(1),active:s,range:u},callback:function(){r=n.resetComponent()}})}}},state:{init:function(){return{active:!1,range:{},text:null}},apply:function(e,t){return n.apply(e,t,s,r)}},props:{handleKeyDown:function(e,t){r.text.length<=0||(t.key.includes("Arrow")?r=n.resetComponent():(r.apply=void 0!==[" ","Tab","Enter","PageUp","PageDown","Home","End","Escape","Spacebar"].find((function(e){return e===t.key})),r.apply&&u(e)))},handleClick:function(e){return!(r.text.length<=0)&&(!(r.from<=e.state.selection.from&&r.to>=e.state.selection.to)&&(u(e),!0))}}})}},"52bL":function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),r=n.n(i),o=n("TGM/"),a=n.n(o),s={extends:r.a,props:{ariaLabel:String},data:function(){return{textContent:"",dropdownShown:!1}},mounted:function(){this.observer=new MutationObserver(this.$_updateTextContent),this.observer.observe(this.$refs.content,{childList:!0,subtree:!0,characterData:!0}),this.$_updateTextContent()},beforeDestroy:function(){this.observer.disconnect()},methods:{showDropdown:function(){var e=this;this.context.showMarkDropdown(this.getRange).then((function(t){e.dropdownShown=!0,t.$on("dismiss",(function(){return e.dropdownShown=!1}))}))},$_updateTextContent:function(){var e=this,t=a()();setTimeout((function(){t(),e.textContent=e.$refs.content.textContent}),0)}}},u=n("KHd+"),c=Object(u.a)(s,(function(){var e=this.$createElement;return(this._self._c||e)("a",{ref:"content",attrs:{href:this.attrs.href,title:this.attrs.title},on:{click:this.showDropdown}})}),[],!1,null,null,null);c.options.__hasBlocks={script:!0,template:!0};t.default=c.exports},"5h9J":function(e,t){e.exports=tui.require("tui/components/buttons/ButtonIcon")},"5kVk":function(e,t){},"5vO2":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return N}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("GcJT"),u=n("22E+"),c=n("daNz"),l=n("XAXS"),d=n("zTcH"),f=n("ulH4"),p=n("PvNB"),m=n("v+xu"),h=n("/7YT"),v=n("SeWd"),k=n("mi/L"),g=n("vFxO"),_=(n("U9km"),n("7F6Z")),y=n("w52A"),b=n("TXEh"),x=n("vyVp"),w=n("V68o"),N=function(){function e(t){var n=this;r()(this,e),this.uid=Object(b.uniqueId)(),this._options=t,this._parent=t.parent,this.viewExtrasEl=t.viewExtrasEl,this.viewExtrasLiveEl=t.viewExtrasLiveEl,this.view=null,this.state=null,this._extensions=t.extensions||[],this.fileStorage=t.fileStorage,this._extensions.forEach((function(e){return e.setEditor(n)}));var i={};this._nodeViews={};var o={};this._markViews={},this._allVueComponents=[],this._extensions.forEach((function(e){n._extractExtensionSchema(e,"node","nodes",i,n._nodeViews),n._extractExtensionSchema(e,"mark","marks",o,n._nodeViews)})),this.schema=Object(k.createSchema)({nodes:i,marks:o}),this._plugins=[Object(_.default)(t.placeholder)],this._extensions.forEach((function(e){var t=e.plugins();t&&t.forEach((function(e){return n._plugins.push(e)}))})),this._toolbarItemInstances=this._extensions.reduce((function(e,t){return t.toolbarItems?e.concat(t.toolbarItems()):e}),[]),this._toolbarItems=this._toolbarItemInstances.map((function(e){return e.getDef()})),this._mapKeys=this._extensions.map((function(e){return e.keymap&&e.keymap.bind(e)})).filter(Boolean),this._inputRules=this._extensions.reduce((function(e,t){return t.inputRules?e.concat(t.inputRules()):e}),[]),this.dispatch=this.dispatch.bind(this),this.execute=this.execute.bind(this),this.getFileStorageItemId=this.getFileStorageItemId.bind(this),this.setValue(t.value)}return a()(e,[{key:"updateFileItemId",value:function(e){this.fileStorage.updateFileItemId(e)}},{key:"_extractExtensionSchema",value:function(e,t,n,i,r){var o=e[n]&&e[n]();if(o)for(var a in o){var s=o[a];i[a]&&console.warn("[editor_weka] ".concat(t,' "').concat(a,'" was redefined')),i[a]=s.schema,s.component&&(this._allVueComponents.push(s.component),r[a]=this._componentNodeView.bind(this,s.component,s.componentContext)),s.view&&(r[a]=s.view)}}},{key:"setValue",value:function(e){if(!e.inflated(this))if(e.hasHtml()){var t=document.createElement("div");t.innerHTML=e.getHtml();var n=s.EditorState.create(Object.assign({},this._editorConfig(),{doc:h.DOMParser.fromSchema(this.schema).parse(t)}));e.inflate(this,n)}else{var i=s.EditorState.fromJSON(this._editorConfig(),{doc:e.getDoc(),selection:{anchor:0,head:0,type:"text"}});e.inflate(this,i)}this._value=e,this.state=e.getState(this),this.view&&this.view.updateState(this.state)}},{key:"_editorConfig",value:function(){return{schema:this.schema,plugins:this._createPlugins()}}},{key:"createView",value:function(e){var t=this,n={class:"tui-weka-editor",role:"region","aria-label":Object(w.langString)("pluginname","editor_weka")};return this._options.placeholder&&(n["aria-label"]=this._options.placeholder),this.view=new u.EditorView(e,{state:this.state,dispatchTransaction:this.dispatch,nodeViews:this._nodeViews,attributes:n}),this.view.dom.addEventListener("focus",(function(e){t._options.onFocus&&t._options.onFocus(e)})),this.view.dom.addEventListener("blur",(function(e){t._options.onBlur&&t._options.onBlur(e)})),this.view}},{key:"allVueComponents",value:function(){return this._allVueComponents}},{key:"allStrings",value:function(){return this._toolbarItems.filter((function(e){return e.label})).map((function(e){return e.label})).concat([Object(w.langString)("pluginname","editor_weka")])}},{key:"getParent",value:function(){return this._parent}},{key:"_componentNodeView",value:function(e,t,n,i,r){return new g.default(e,{editor:this,node:n,view:i,getPos:r,parent:this._parent,context:t})}},{key:"dispatch",value:function(e){var t=this.state.apply(e);this.view.updateState(t),this.state=t,this._value=y.default.fromState(t,this),this._options.onTransaction&&this._options.onTransaction({value:this._value,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this._options.onUpdate&&this._options.onUpdate(this._value)}},{key:"getFileStorageItemId",value:function(){return this.fileStorage.getFileStorageItemId()}},{key:"_createPlugins",value:function(){var e=[];return Array.isArray(this._plugins)&&(e=this._plugins),e.concat(Object(m.inputRules)({rules:this._inputRules}),Object(c.keymap)(Object(v.buildKeymap)(this.schema,this._mapKeys)),Object(c.keymap)(d.baseKeymap),Object(f.dropCursor)(),Object(p.gapCursor)(),Object(l.history)())}},{key:"getToolbarItems",value:function(){var e=this;return this._toolbarItemInstances.forEach((function(t){return t.update(e)})),this._toolbarItems}},{key:"execute",value:function(e){try{return e(this.state,this.dispatch,this.view)}catch(e){console.error("[Weka] Failed to execute command."),console.error(e);var t=Object(w.langString)("error_failed_to_execute","editor_weka");return Object(w.loadLangStrings)([t]).then((function(){return Object(x.notify)({type:"error",message:t.toString()})})),!1}}},{key:"canExecute",value:function(e){return e(this.state,null,null)}},{key:"hasNode",value:function(e){return e in this.state.schema.nodes}},{key:"destroy",value:function(){this.view&&this.view.destroy()}}]),e}()},"6RS6":function(e,t){e.exports=tui.require("editor_weka/components/nodes/Attachments")},"6gLU":function(e,t,n){var i={"./Weka":"NqIU","./Weka.vue":"NqIU","./attachments/AudioAttachment":"dRRP","./attachments/AudioAttachment.vue":"dRRP","./attachments/FileAttachment":"DOZ8","./attachments/FileAttachment.vue":"DOZ8","./attachments/ImageAttachment":"iFtU","./attachments/ImageAttachment.vue":"iFtU","./attachments/VideoAttachment":"d+14","./attachments/VideoAttachment.vue":"d+14","./editing/ActionDropdown":"T27E","./editing/ActionDropdown.vue":"T27E","./editing/EditImageAltTextModal":"XS2e","./editing/EditImageAltTextModal.vue":"XS2e","./editing/EditLinkModal":"j1Jf","./editing/EditLinkModal.vue":"j1Jf","./editing/EmojiSelector":"TZft","./editing/EmojiSelector.vue":"TZft","./editing/PositionedActionDropdown":"ENqZ","./editing/PositionedActionDropdown.vue":"ENqZ","./marks/Link":"52bL","./marks/Link.vue":"52bL","./nodes/Attachment":"WF6d","./nodes/Attachment.vue":"WF6d","./nodes/Attachments":"nhhl","./nodes/Attachments.vue":"nhhl","./nodes/AudioBlock":"av8V","./nodes/AudioBlock.vue":"av8V","./nodes/BaseNode":"TNgD","./nodes/BaseNode.vue":"TNgD","./nodes/Emoji":"AhbH","./nodes/Emoji.vue":"AhbH","./nodes/Hashtag":"fNlv","./nodes/Hashtag.vue":"fNlv","./nodes/ImageBlock":"7QQN","./nodes/ImageBlock.vue":"7QQN","./nodes/LinkBlock":"hFhO","./nodes/LinkBlock.vue":"hFhO","./nodes/LinkMedia":"gfQI","./nodes/LinkMedia.vue":"gfQI","./nodes/Mention":"DVbZ","./nodes/Mention.vue":"DVbZ","./nodes/VideoBlock":"ywTm","./nodes/VideoBlock.vue":"ywTm","./suggestion/Hashtag":"1mLp","./suggestion/Hashtag.vue":"1mLp","./suggestion/User":"9Dx/","./suggestion/User.vue":"9Dx/","./toolbar/NodeBar":"bo3x","./toolbar/NodeBar.vue":"bo3x","./toolbar/Toolbar":"WwJ/","./toolbar/Toolbar.vue":"WwJ/","./toolbar/ToolbarButton":"8NkA","./toolbar/ToolbarButton.vue":"8NkA","./toolbar/ToolbarButtonIcon":"0oIn","./toolbar/ToolbarButtonIcon.vue":"0oIn","./upload/FilePicker":"Kbs0","./upload/FilePicker.vue":"Kbs0"};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id="6gLU"},"6o14":function(e,t){},"7F6Z":function(e,t,n){"use strict";n.r(t);var i=n("GcJT"),r=n("22E+");t.default=function(e){return new i.Plugin({key:new i.PluginKey("text-placeholder"),props:{decorations:function(t){var n=t.doc;if(!e)return!1;if(1!==n.childCount||!n.firstChild.isTextblock)return!1;var i=[];return n.descendants((function(t,n){return t.type.isBlock&&0==t.childCount&&i.push(r.Decoration.node(n,n+t.nodeSize,{class:"tui-weka__placeholder","data-placeholder":e})),!0})),r.DecorationSet.create(n,i)}}})}},"7O4h":function(e,t){},"7QQN":function(e,t,n){"use strict";n.r(t);var i=n("iPZg"),r=n.n(i),o=n("tnXT"),a=n.n(o),s=n("hg2Q"),u=n("r4xq"),c=n.n(u),l=n("yHzl"),d=n.n(l),f=n("Mnur"),p=n.n(f),m={components:{EditImageAltTextModal:d.a,ModalPresenter:p.a,ImageBlock:r.a,NodeBar:c.a},extends:a.a,apollo:{file:{query:s.a,variables:function(){return{filename:this.filename,item_id:this.itemId}}}},data:function(){return{file:{},showModal:!1}},computed:{hasAttachmentNode:function(){return!!this.context.hasAttachmentNode&&this.context.hasAttachmentNode()},actions:function(){var e=this,t=[];return this.hasAttachmentNode&&t.push({label:this.$str("display_as_attachment","editor_weka"),action:function(){e.$_toAttachment()}}),t=t.concat([{label:this.altTextLabel,action:function(){e.$_showModal()}},{label:this.$str("remove","core"),action:function(){e.$_removeNode()}}]),this.downloadUrl&&t.push({label:this.$str("download","core"),action:function(){window.document.location.href=e.downloadUrl}}),t},altTextLabel:function(){return this.altText?this.$str("edit_image_alt_text","editor_weka"):this.$str("add_image_alt_text","editor_weka")},altText:function(){return this.attrs.alttext?this.attrs.alttext:""},filename:function(){return this.attrs.filename?this.attrs.filename:null},itemId:function(){if(!this.context.getItemId)throw new Error("No function 'getItemId' for extension media");return this.context.getItemId()},downloadUrl:function(){return this.context.getFileUrl?this.context.getFileUrl(this.filename):null}},methods:{$_toAttachment:function(){if(this.context.replaceWithAttachment){var e={filename:this.filename,alttext:this.altText,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)}},$_showModal:function(){this.showModal=!0},$_hideModal:function(){this.showModal=!1},$_updateAltText:function(e){if(this.$_hideModal(),this.context.updateImage){var t={filename:this.filename,alttext:e};this.context.updateImage(this.getRange,t)}},$_removeNode:function(){if(this.context.removeNode)return this.context.removeNode(this.getRange)}}},h=(n("lH1I"),n("KHd+")),v=function(e){e.options.__langStrings={core:["loadinghelp","remove","download"],editor_weka:["display_as_attachment","add_image_alt_text","edit_image_alt_text","actions_menu_for"]}},k=Object(h.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaImageBlock"},[e.$apollo.loading?[n("p",{staticClass:"tui-wekaImageBlock__text"},[e._v("\n      "+e._s(e.$str("loadinghelp","core"))+"\n    ")])]:n("div",{staticClass:"tui-wekaImageBlock__inner"},[n("ModalPresenter",{attrs:{open:e.showModal},on:{"request-close":e.$_hideModal}},[n("EditImageAltTextModal",{attrs:{value:e.altText},on:{change:e.$_updateAltText}})],1),e._v(" "),n("ImageBlock",{attrs:{url:e.file.url,filename:e.filename,"alt-text":e.altText}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)],2)}),[],!1,null,null,null);"function"==typeof v&&v(k),k.options.__hasBlocks={script:!0,template:!0};t.default=k.exports},"7W2i":function(e,t,n){var i=n("SksO");e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}},"7fvA":function(e,t,n){"use strict";n.r(t);var i=n("nEm4"),r=n.n(i),o=n("i/kK"),a=n.n(o),s=n("2wx7"),u=n.n(s),c=n("kkOl"),l=n.n(c),d=n("BN8m"),f=n.n(d),p=n("oMuj"),m=n.n(p),h=n("KRvX"),v=n.n(h),k=n("vF5l"),g=n.n(k),_={components:{Form:r.a,FormRow:a.a,Weka:u.a,ButtonGroup:f.a,InputText:m.a,Submit:v.a,Button:g.a},props:{defaultDoc:{type:String,default:""},instanceId:[String,Number],sesskey:{type:String,required:!0}},data:function(){return{content:null,itemId:this.instanceId}},computed:{documentValue:function(){return this.content?JSON.stringify(this.content.getDoc()):""},jsonPretty:function(){return this.content?JSON.stringify(this.content.getDoc(),void 0,2):""}},watch:{defaultDoc:{immediate:!0,handler:function(e){e&&(this.content=l.a.fromDoc(JSON.parse(e)))}},content:function(e){e&&(this.itemId=e.fileStorageItemId)}}},y=(n("GDyI"),n("KHd+")),b=function(e){e.options.__langStrings={editor_weka:["pluginname"],core:["cancel"]}},x=Object(y.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaWithLearn"},[n("h3",{staticClass:"tui-wekaWithLearn__title"},[e._v("\n    "+e._s(e.$str("pluginname","editor_weka"))+"\n  ")]),e._v(" "),n("Form",{staticClass:"tui-wekaWithLearn__form",attrs:{method:"POST",action:e.$url("/lib/editor/weka/tests/fixtures/weka_with_learn.php",{sesskey:e.sesskey}),"input-width":"full",vertical:!0}},[n("FormRow",{staticClass:"tui-wekaWithLearn__formRow",attrs:{label:e.$str("pluginname","editor_weka")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("Weka",{attrs:{id:i,component:"editor_weka",area:"learn","instance-id":e.instanceId,"file-item-id":e.instanceId},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})]}}])}),e._v(" "),n("FormRow",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tui-wekaWithLearn__formRow",attrs:{hidden:!0},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,name:"json_content",value:e.documentValue,hidden:!0}})]}}])}),e._v(" "),n("FormRow",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tui-wekaWithLearn__formRow",attrs:{hidden:!0},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,name:"item_id",value:e.itemId,hidden:!0}})]}}])}),e._v(" "),n("ButtonGroup",{staticClass:"tui-wekaWithLearn__buttonGroup"},[n("Submit"),e._v(" "),n("Button",{attrs:{type:"submit",name:"cancel",value:"1",text:e.$str("cancel","core")}})],1)],1),e._v(" "),n("hr"),e._v(" "),n("pre",{staticClass:"tui-wekaWithLearn__code"},[e._v(e._s(e.jsonPretty))])],1)}),[],!1,null,null,null);"function"==typeof b&&b(x),x.options.__hasBlocks={script:!0,template:!0};t.default=x.exports},"7gPm":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("G709"),f=n("KY8K"),p=n("V68o"),m=n("vyVp"),h=Object.prototype.hasOwnProperty,v=function(){function e(t){var n=t.contextId,i=t.itemId;u()(this,e),this.repositoryData=null,this.files={},this.itemId=null,i&&(this.itemId=i),this.contextId=n}var t,n,i;return l()(e,[{key:"updateFileItemId",value:function(e){this.itemId=e}},{key:"getContextId",value:function(){return this.contextId}},{key:"setRepositoryData",value:function(e){var t=e.repository_id,n=e.url;this.repositoryData||(this.repositoryData={repositoryId:t,url:n})}},{key:"_fetchRepositoryData",value:(i=a()(r.a.mark((function e(){var t=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.repositoryData?e("done"):Object(d.prepareDraftFileArea)(t.contextId).then((function(n){var i=n.repository_id,r=n.url;t.setRepositoryData({repository_id:i,url:r}),e("done")}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"getRepositoryData",value:function(){return this.repositoryData}},{key:"getFileStorageItemId",value:function(){return this.itemId}},{key:"addFile",value:function(e){var t=e.file,n=e.size,i=e.url;h.call(this.files,t)||(this.files[t]={file:t,size:n,url:i})}},{key:"getFile",value:function(e){return h.call(this.files,e)?this.files[e]:null}},{key:"uploadFile",value:(n=a()(r.a.mark((function e(t,n){var i,o,a,s,u,c,l,d,m,v,k,g;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchRepositoryData();case 2:return i=this.repositoryData,o=i.repositoryId,a=i.url,e.next=5,Object(f.upload)({file:t,itemId:this.itemId,contextId:this.contextId,acceptTypes:n,repositoryId:o,url:a});case 5:if(!(s=e.sent).id||!s.file){e.next=13;break}return(u=Object.assign({},s)).size=t.size,this.addFile(u),e.abrupt("return",u);case 13:if("fileexists"!==s.event){e.next=20;break}if(c=s.existingfile.filename,l=s.newfile,d=l.filename,m=l.url,!h.call(this.files,c)){e.next=20;break}return v=this.files[c].size,k={id:this.itemId,url:m,file:d,size:v},this.addFile(k),e.abrupt("return",k);case 20:return g=Object(p.langString)("invalid_response","editor_weka"),e.next=23,Object(p.loadLangStrings)([g]);case 23:throw new Error(g.toString());case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"uploadFiles",value:(t=a()(r.a.mark((function e(t,n){var i=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(f.parseFiles)(t),e.abrupt("return",new Promise((function(e,r){if(0!==t.length)if(i.checkFilesSizeExceed(t)){var o=Object(p.langString)("file_size_exceed","editor_weka",60);Object(p.loadLangStrings)([o]).then((function(){return Object(m.notify)({type:"error",message:o.toString()})}))}else Promise.all(t.map((function(e){return i.uploadFile(e,n)}))).then((function(t){e(t)})).catch((function(e){r(e)}));else e([])})));case 2:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"checkFilesSizeExceed",value:function(e){return e.some((function(e){return e.size>62914560}))}},{key:"enabled",get:function(){return!!this.itemId}}]),e}()},"7osU":function(e,t,n){"use strict";n.r(t);var i=n("GcJT"),r=n("/7YT");t.default=function(e,t,n){var o=new i.PluginKey("emojis"),a=!1;return new i.Plugin({key:o,appendTransaction:function(e,t,n){var i=o.getState(n),r=i.text,a=i.active,s=i.range,u=i.emoji;if(!r||!a)return null;var c=n.schema.node("emoji",{id:u.id,shortcode:u.shortcode});return n.tr.replaceWith(s.from,s.to,c)},state:{init:function(){return{active:!1,range:{},text:null}},apply:function(e,n){var i=e.selection,o=Object.assign({},n);if(o.active=!1,!a)return o;if(i.from===i.to){var s=function(e,t){if(!(e&&e instanceof r.ResolvedPos))return null;var n,i,o=e.doc.textBetween(e.start(),e.end(),"\0","\0");if(""===o)return null;if(!t)return null;for(var a=0;a<t.length;++a){var s=t[a];if(""!==s.pattern)for(i=new RegExp(s.pattern,"g");n=i.exec(o);){var u=n.input.slice(Math.max(0,n.index-1),n.index);if(/^[\s\0]?$/.test(u)){var c=n.index+e.start(),l=c+n[0].length;if(c<e.pos&&l>=e.pos)return{range:{from:c,to:l},text:n[0],emoji:s}}}}return null}(i.$from,t);s&&(o.active=!0,o.range=s.range,o.text=s.text,o.emoji=s.emoji)}return o.active||(o.range={},o.text=null),o}},props:{handleKeyDown:function(e,t){a=n.find((function(e){return e===t.key}))}}})}},"7rq0":function(e,t){},"8NkA":function(e,t,n){"use strict";n.r(t);var i=n("vF5l"),r={components:{Button:n.n(i).a},props:{text:{type:String,required:!0},selected:{type:Boolean,default:null},caret:Boolean,disabled:Boolean},computed:{ariaPressed:function(){return null==this.selected?null:this.selected?"true":"false"}}},o=(n("7rq0"),n("KHd+")),a=Object(o.a)(r,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("Button",{staticClass:"tui-wekaToolbarButton",class:{"tui-wekaToolbarButton--selected":e.selected},attrs:{"aria-label":e.text,"aria-pressed":e.ariaPressed,text:e.text,caret:e.caret,disabled:e.disabled},on:{click:function(t){return e.$emit("click",t)}}})}),[],!1,null,null,null);a.options.__hasBlocks={script:!0,template:!0};t.default=a.exports},"90QZ":function(e,t){e.exports=tui.require("tui/components/icons/ListUnordered")},"9Dx/":function(e,t,n){"use strict";n.r(t);var i=n("gLvT"),r=n.n(i),o=n("KGcv"),a=n.n(o),s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_find_users_by_pattern"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pattern"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contextid"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"users"},name:{kind:"Name",value:"editor_weka_users_by_pattern"},arguments:[{kind:"Argument",name:{kind:"Name",value:"pattern"},value:{kind:"Variable",name:{kind:"Name",value:"pattern"}}},{kind:"Argument",name:{kind:"Name",value:"contextid"},value:{kind:"Variable",name:{kind:"Name",value:"contextid"}}},{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fullname"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"card_display"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile_picture_alt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile_picture_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profile_url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"display_fields"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"value"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"is_custom"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"associate_url"},arguments:[],directives:[]}]}}]}}]}}]}}]},u=n("+MEP"),c=n.n(u),l=n("JXQf"),d=n.n(l),f={components:{Dropdown:r.a,DropdownItem:a.a,MiniProfileCard:c.a,Loader:d.a},props:{contextId:{type:[Number,String]},component:{type:String},area:{type:String},location:{required:!0,type:Object},pattern:{required:!0,type:String}},apollo:{users:{query:s,fetchPolicy:"network-only",variables:function(){return{pattern:this.pattern,contextid:this.contextId,component:this.component,area:this.area}}}},data:function(){return{users:[]}},computed:{positionStyle:function(){return{left:"".concat(this.location.x,"px"),top:"".concat(this.location.y,"px")}}},methods:{pickUser:function(e){var t=e.id,n=e.fullname;this.$emit("item-selected",{id:t,text:n})}}},p=(n("6o14"),n("KHd+")),m=function(e){e.options.__langStrings={editor_weka:["matching_users"]}},h=Object(p.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaUserSuggestions",style:e.positionStyle},[n("Dropdown",{attrs:{separator:!0,open:e.$apollo.loading||e.users.length>0,"inline-menu":!0},on:{dismiss:function(t){return e.$emit("dismiss")}}},[n("span",{staticClass:"sr-only"},[e._v("\n      "+e._s(e.$str("matching_users","editor_weka"))+":\n    ")]),e._v(" "),e.$apollo.loading?[n("DropdownItem",{attrs:{disabled:!0}},[n("Loader",{attrs:{loading:!0}})],1)]:e._e(),e._v(" "),e._l(e.users,(function(t,i){return n("DropdownItem",{key:i,attrs:{"no-padding":!0},on:{click:function(n){return e.pickUser(t)}}},[n("MiniProfileCard",{attrs:{"no-border":!0,display:t.card_display}})],1)}))],2)],1)}),[],!1,null,null,null);"function"==typeof m&&m(h),h.options.__hasBlocks={script:!0,template:!0};t.default=h.exports},"9G+f":function(e,t){e.exports=tui.require("tui/components/popover/Popover")},"9Ovj":function(e,t){e.exports=tui.require("editor_weka/components/toolbar/ToolbarButton")},"9Wm2":function(e,t){e.exports=tui.require("editor_weka/components/marks/Link")},"9Y8s":function(e,t){e.exports=tui.require("tui/components/icons/Image")},"9cw/":function(e,t){e.exports=tui.require("editor_weka/components/nodes/LinkMedia")},"9iry":function(e,t){e.exports=tui.require("tui/vue_util")},"AL+t":function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/VideoBlock")},AT4M:function(e,t){},AhbH:function(e,t,n){"use strict";n.r(t);var i=n("QCX9"),r=n.n(i),o=n("tnXT"),a=n.n(o),s={components:{Emoji:r.a},extends:a.a,computed:{shortCode:function(){if(this.attrs.shortcode)return this.attrs.shortcode}}},u=n("KHd+"),c=Object(u.a)(s,(function(){var e=this.$createElement;return(this._self._c||e)("Emoji",{staticClass:"tui-wekaEmoji",attrs:{"short-code":this.shortCode}})}),[],!1,null,null,null);c.options.__hasBlocks={script:!0,template:!0};t.default=c.exports},AtFJ:function(e,t){e.exports=tui.require("editor_weka/components/nodes/AudioBlock")},B6jB:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("zJMb"),m=n("V68o"),h=n("cy56"),v=n("zTcH"),k=n("v+xu"),g=n("yrzs"),_=n.n(g),y=n("/+gN"),b=n.n(y);function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var w=["blockquote",0],N=["em",0],O=["strong",0],S=["h4","h5"],I=function(e){u()(n,e);var t=x(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{blockquote:{schema:{group:"block",content:"block+",parseDOM:[{tag:"blockquote"}],toDOM:function(){return w}}},heading:{schema:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(e){return["h"+e.attrs.level,0]}},view:function(e){var t=Math.max(e.attrs.level,1)-1,n=S[t]||S[S.length-1],i=document.createElement(n);return{dom:i,contentDOM:i}}},hard_break:{schema:{group:"inline",parseDOM:[{tag:"br"}],toDOM:function(){return["br"]},inline:!0,selectable:!1}}}}},{key:"marks",value:function(){return{em:{schema:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return N}}},strong:{schema:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(e){return"normal"!=e.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(e){return/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}}],toDOM:function(){return O}}}}}},{key:"toolbarItems",value:function(){var e=this.getSchema().nodes.paragraph,t=this.getSchema().nodes.heading,n=this.getSchema().marks.strong,i=this.getSchema().marks.em;return[Object(h.blockTypeItem)(e,{},{group:"blocks",label:Object(m.langString)("paragraph","editor")}),Object(h.blockTypeItem)(t,{attrs:{level:1}},{group:"blocks",label:Object(m.langString)("heading","editor")}),Object(h.blockTypeItem)(t,{attrs:{level:2}},{group:"blocks",label:Object(m.langString)("subheading","editor")}),Object(h.markItem)(n,{group:"text",label:Object(m.langString)("bold","editor"),iconComponent:_.a}),Object(h.markItem)(i,{group:"text",label:Object(m.langString)("italic","editor"),iconComponent:b.a})]}},{key:"keymap",value:function(e,t){var n=t.isMac,i=this.getSchema().nodes,r=i.paragraph,o=i.blockquote,a=i.heading,s=i.hard_break,u=this.getSchema().marks,c=u.strong,l=u.em;e("Shift-Ctrl-0",Object(v.setBlockType)(r)),e("Ctrl->",Object(v.wrapIn)(o));for(var d=1;d<=6;d++)e("Shift-Ctrl-"+d,Object(v.setBlockType)(a,{level:d}));var f=function(e,t){return t(e.tr.replaceSelectionWith(s.create()).scrollIntoView()),!0};e("Mod-Enter",f),e("Shift-Enter",f),n&&e("Ctrl-Enter",f),e("Mod-b",Object(v.toggleMark)(c)),e("Mod-B",Object(v.toggleMark)(c)),e("Mod-i",Object(v.toggleMark)(l)),e("Mod-I",Object(v.toggleMark)(l))}},{key:"inputRules",value:function(){var e,t=this.getSchema().nodes,n=t.blockquote,i=t.heading;return[k.ellipsis,(e=n,Object(k.wrappingInputRule)(/^\s*>\s$/,e)),j(i,6)]}}]),n}(p.default);function j(e,t){return Object(k.textblockTypeInputRule)(new RegExp("^(#{1,"+t+"})\\s$"),e,(function(e){return{level:e[1].length}}))}t.default=function(e){return new I(e)}},BN8m:function(e,t){e.exports=tui.require("tui/components/buttons/ButtonGroup")},CLKc:function(e,t,n){"use strict";n.r(t);var i=n("2wx7"),r={components:{Weka:n.n(i).a}},o=n("KHd+"),a=Object(o.a)(r,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tui-fixture-wekaBasic"},[t("Weka",{attrs:{component:"editor_weka",area:"behat"}})],1)}),[],!1,null,null,null);a.options.__hasBlocks={script:!0,template:!0};t.default=a.exports},CksW:function(e,t){e.exports=tui.require("ext_prosemirror/transform")},CvRQ:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("Y4vP"),m=n.n(p),h=n("zJMb"),v=n("dleW");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var g=function(e){u()(n,e);var t=k(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{mention:{schema:{group:"inline",inline:!0,attrs:{type:{default:void 0},id:{default:void 0},display:{default:""}},parseDOM:[{tag:"span.tui-wekaNodeMention",getAttrs:function(e){try{return{type:JSON.parse(e.getAttribute("data-type")),id:JSON.parse(e.getAttribute("data-id")),display:e.textContent.trim().slice(1)}}catch(e){return{}}}}],toDOM:function(e){return["span",{class:"tui-wekaNodeMention","data-type":JSON.stringify(e.attrs.type),"data-id":JSON.stringify(e.attrs.id)},"@"+e.attrs.display]}},component:m.a}}}},{key:"plugins",value:function(){return[Object(v.default)(this.editor)]}}]),n}(h.default);t.default=function(e){return new g(e)}},"Cx/y":function(e,t){e.exports=tui.require("editor_weka/components/nodes/ImageBlock")},D3bS:function(e,t){e.exports=tui.require("editor_weka/components/attachments/ImageAttachment")},D7iR:function(e,t,n){"use strict";n.r(t),n.d(t,"findParentNode",(function(){return o})),n.d(t,"findParentNodeClosestToPos",(function(){return a})),n.d(t,"findParentDomRef",(function(){return s})),n.d(t,"hasParentNode",(function(){return u})),n.d(t,"findParentNodeOfType",(function(){return c})),n.d(t,"findParentNodeOfTypeClosestToPos",(function(){return l})),n.d(t,"hasParentNodeOfType",(function(){return d})),n.d(t,"findParentDomRefOfType",(function(){return f})),n.d(t,"findSelectedNodeOfType",(function(){return p})),n.d(t,"findPositionOfNodeBefore",(function(){return m})),n.d(t,"findDomRefAtPos",(function(){return h}));var i=n("GcJT"),r=n("Ko4C"),o=function(e){return function(t){var n=t.$from;return a(n,e)}},a=function(e,t){for(var n=e.depth;n>0;n--){var i=e.node(n);if(t(i))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:i}}},s=function(e,t){return function(n){var i=o(e)(n);if(i)return h(i.pos,t)}},u=function(e){return function(t){return!!o(e)(t)}},c=function(e){return function(t){return o((function(t){return Object(r.equalNodeType)(e,t)}))(t)}},l=function(e,t){return a(e,(function(e){return Object(r.equalNodeType)(t,e)}))},d=function(e){return function(t){return u((function(t){return Object(r.equalNodeType)(e,t)}))(t)}},f=function(e,t){return function(n){return s((function(t){return Object(r.equalNodeType)(e,t)}),t)(n)}},p=function(e){return function(t){if(Object(r.isNodeSelection)(t)){var n=t.node,i=t.$from;if(Object(r.equalNodeType)(e,n))return{node:n,pos:i.pos,depth:i.depth}}}},m=function(e){var t=e.$from.nodeBefore,n=i.Selection.findFrom(e.$from,-1);if(n&&t){var r=c(t.type)(n);return r?r.pos:n.$from.pos}},h=function(e,t){var n=t(e),i=n.node.childNodes[n.offset];return n.node.nodeType===Node.TEXT_NODE?n.node.parentNode:i&&i.nodeType!==Node.TEXT_NODE?i:n.node}},DOZ8:function(e,t,n){"use strict";n.r(t);var i=n("RNtj"),r=n.n(i),o=n("r4xq"),a=n.n(o),s=n("zK61"),u=n.n(s),c={components:{AttachmentNode:r.a,NodeBar:a.a},mixins:[u.a],computed:{actions:function(){var e=this,t=[{label:this.$str("remove","core"),action:function(){e.$emit("delete")}}];return this.hasDownloadUrl&&t.push({label:this.$str("download","core"),action:function(){e.$emit("download")}}),t}}},l=n("KHd+"),d=function(e){e.options.__langStrings={core:["remove","download"],editor_weka:["actions_menu_for"]}},f=Object(l.a)(c,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)}),[],!1,null,null,null);"function"==typeof d&&d(f),f.options.__hasBlocks={script:!0,template:!0};t.default=f.exports},DVbZ:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),r=n.n(i),o=n("rqBY"),a={components:{Mention:n.n(o).a},extends:r.a,computed:{displayName:function(){var e=this.attrs;return e.display?e.display:""},userId:function(){var e=this.attrs;return e.id?e.id:0}}},s=(n("VSrT"),n("KHd+")),u=Object(s.a)(a,(function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"tui-wekaMention"},[t("Mention",{attrs:{"user-id":this.userId,fullname:this.displayName},nativeOn:{click:function(e){e.preventDefault()}}})],1)}),[],!1,null,null,null);u.options.__hasBlocks={script:!0,template:!0};t.default=u.exports},EBtw:function(e,t){e.exports=tui.require("editor_weka/components/suggestion/Hashtag")},ENqZ:function(e,t,n){"use strict";n.r(t);var i=n("ce8f"),r={components:{ActionDropdown:n.n(i).a},props:{location:{type:Object,validator:function(e){return"x"in e&&"y"in e}},actions:Array},computed:{wrapperStyle:function(){return{position:"absolute",left:this.location.x+"px",top:this.location.y+"px"}}}},o=n("KHd+"),a=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{style:e.wrapperStyle},[n("ActionDropdown",{attrs:{actions:e.actions,open:!0},on:{dismiss:function(t){return e.$emit("dismiss")}},scopedSlots:e._u([{key:"trigger",fn:function(t){return[e._t("trigger",null,null,t)]}}],null,!0)})],1)}),[],!1,null,null,null);a.options.__hasBlocks={script:!0,template:!0};t.default=a.exports},EzMw:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/ToolbarButtonIcon")},G709:function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("UpZR"),u=n.n(s),c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_get_repository_data"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"repository_data"},name:{kind:"Name",value:"editor_weka_repository_data"},arguments:[{kind:"Argument",name:{kind:"Name",value:"context_id"},value:{kind:"Variable",name:{kind:"Name",value:"context_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]},l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"core_get_linkmetadata"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_url"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"link"},name:{kind:"Name",value:"core_get_linkmetadata"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[{kind:"Argument",name:{kind:"Name",value:"format"},value:{kind:"EnumValue",value:"PLAIN"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"videoheight"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"videowidth"},arguments:[],directives:[]}]}}]}}]},d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_media_type_of_draft_file"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"item_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"file"},name:{kind:"Name",value:"editor_weka_draft_file"},arguments:[{kind:"Argument",name:{kind:"Name",value:"item_id"},value:{kind:"Variable",name:{kind:"Name",value:"item_id"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]}]}}]}}]};function f(e){return p.apply(this,arguments)}function p(){return(p=a()(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.query({query:l,variables:{url:t}});case 2:return n=e.sent,e.abrupt("return",n.data.link);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return h.apply(this,arguments)}function h(){return(h=a()(r.a.mark((function e(){var t,n,i,o=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:null,e.next=3,u.a.query({query:c,variables:{context_id:t},fetchPolicy:"no-cache"});case 3:return n=e.sent,i=n.data.repository_data,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return k.apply(this,arguments)}function k(){return(k=a()(r.a.mark((function e(t){var n,i,o,a,s,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.itemId,i=t.filename,e.next=3,u.a.query({query:d,variables:{item_id:n,filename:i}});case 3:return o=e.sent,a=o.data.file,s=a.media_type,c=a.mime_type,e.abrupt("return",{mediaType:s,mimeType:c});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.d(t,"getLinkMetadata",(function(){return f})),n.d(t,"prepareDraftFileArea",(function(){return m})),n.d(t,"getMediaType",(function(){return v}))},GDyI:function(e,t){},GcJT:function(e,t){e.exports=tui.require("ext_prosemirror/state")},GqWi:function(e,t){e.exports=tui.require("editor_weka/components/attachments/VideoAttachment")},"H/tB":function(e,t){e.exports=tui.require("tui/tui")},IBd2:function(e,t){e.exports=tui.require("tui/components/images/ResponsiveImage")},It5U:function(e,t){},J4zp:function(e,t,n){var i=n("wTVA"),r=n("m0LI"),o=n("ZhPi"),a=n("wkBT");e.exports=function(e,t){return i(e)||r(e,t)||o(e,t)||a()}},JXQf:function(e,t){e.exports=tui.require("tui/components/loading/Loader")},KGcv:function(e,t){e.exports=tui.require("tui/components/dropdown/DropdownItem")},"KHd+":function(e,t,n){"use strict";function i(e,t,n,i,r,o,a,s){var u,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),i&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),a?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=u):r&&(u=s?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),u)if(c.functional){c._injectStyles=u;var l=c.render;c.render=function(e,t){return u.call(t),l(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,u):[u]}return{exports:e,options:c}}n.d(t,"a",(function(){return i}))},KRvX:function(e,t){e.exports=tui.require("tui/components/buttons/Submit")},KY8K:function(e,t,n){"use strict";n.r(t),n.d(t,"UploadError",(function(){return O})),n.d(t,"parseFiles",(function(){return S})),n.d(t,"upload",(function(){return I})),n.d(t,"pickFiles",(function(){return T}));var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("7W2i"),l=n.n(c),d=n("a1gu"),f=n.n(d),p=n("Nsbk"),m=n.n(p),h=n("oShl"),v=n.n(h),k=n("12HA"),g=n("TGM/"),_=n.n(g),y=n("Wdod"),b=n.n(y),x=n("i7/w"),w=n.n(x);n("5vO2");function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=m()(e);if(t){var r=m()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return f()(this,n)}}var O=function(e){l()(n,e);var t=N(n);function n(e){var i;return u()(this,n),(i=t.call(this,e)).name="UploadError",i}return n}(v()(Error));function S(e){return Array.isArray(e)?e:Array.prototype.slice.call(e).filter((function(e){return e instanceof File}))}function I(e){return j.apply(this,arguments)}function j(){return(j=a()(r.a.mark((function e(t){var n,i,o,a,s,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.file,i=t.repositoryId,o=t.itemId,a=t.contextId,s=t.acceptTypes,u=t.url,e.abrupt("return",new Promise((function(e,t){var r=new FormData,c=new XMLHttpRequest;r.append("repo_upload_file",n),r.append("title",n.name),r.append("sesskey",k.config.sesskey),r.append("repo_id",String(i)),r.append("itemid",String(o)),r.append("ctx_id",String(a)),s.forEach((function(e){return r.append("accepted_types[]",e)})),c.addEventListener("readystatechange",(function(){if(4===c.readyState){if(200!==c.status)return void t(new Error("Response is not a 200 response"));var n=JSON.parse(c.responseText);if(n.error)return void t(new O(n.error));e(n)}})),c.open("POST",u,!0),c.send(r)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return A.apply(this,arguments)}function A(){return(A=a()(r.a.mark((function e(t){var n,i,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=w.a.extend(b.a),i=new n({parent:t.getParent(),propsData:{autoTrigger:!0}}),o=_()("weka-file-picker"),setTimeout((function(){o();var e=document.createElement("span");t.viewExtrasEl.appendChild(e),i.$mount(e)}),0),e.abrupt("return",new Promise((function(e){i.$on("picked-files",(function(t){e(t)})),i.$on("dismiss",(function(){i.$destroy(),t.viewExtrasEl.removeChild(i.$el)}))})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},Kbs0:function(e,t,n){"use strict";n.r(t);var i={props:{autoTrigger:{type:Boolean,default:!1},maxFiles:{type:[String,Number]}},computed:{multiple:function(){return 1!=this.maxFiles}},mounted:function(){this.autoTrigger&&(this.$_click(),this.$window.document.addEventListener("keyup",this.$_dismiss))},beforeDestroy:function(){this.$window.document.removeEventListener("keyup",this.$_dismiss)},methods:{$_pickFile:function(e){var t=[];e&&e.target&&e.target.files&&(t=e.target.files),this.$emit("picked-files",t),this.$emit("dismiss")},$_click:function(){this.$refs.fileInput&&this.$refs.fileInput.click()},$_dismiss:function(e){e&&"Escape"===e.key&&this.$emit("dismiss")}}},r=n("KHd+"),o=Object(r.a)(i,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileInput",attrs:{type:"file",multiple:this.multiple},on:{change:this.$_pickFile}})])}),[],!1,null,null,null);o.options.__hasBlocks={script:!0,template:!0};t.default=o.exports},Ko4C:function(e,t,n){"use strict";n.r(t),n.d(t,"isNodeSelection",(function(){return s})),n.d(t,"equalNodeType",(function(){return u})),n.d(t,"cloneTr",(function(){return c})),n.d(t,"replaceNodeAtPos",(function(){return l})),n.d(t,"canReplace",(function(){return d})),n.d(t,"removeNodeAtPos",(function(){return f})),n.d(t,"tableNodeTypes",(function(){return p})),n.d(t,"canInsert",(function(){return m})),n.d(t,"isEmptyParagraph",(function(){return h})),n.d(t,"findTableClosestToPos",(function(){return v})),n.d(t,"createCell",(function(){return k})),n.d(t,"transpose",(function(){return g})),n.d(t,"checkInvalidMovements",(function(){return _}));var i=n("GcJT"),r=n("/7YT"),o=n("VR8M"),a=n("D7iR"),s=function(e){return e instanceof i.NodeSelection},u=function(e,t){return Array.isArray(e)&&e.indexOf(t.type)>-1||t.type===e},c=function(e){return Object.assign(Object.create(e),e).setTime(Date.now())},l=function(e,t){return function(n){var i=n.doc.nodeAt(e),r=n.doc.resolve(e);if(d(r,t)){var a=(n=n.replaceWith(e,e+i.nodeSize,t)).selection.$from.pos-1;return n=Object(o.setTextSelection)(Math.max(a,0),-1)(n),n=Object(o.setTextSelection)(n.selection.$from.start())(n),c(n)}return n}},d=function(e,t){var n=e.node(e.depth);return n&&n.type.validContent(t instanceof r.Fragment?t:r.Fragment.from(t))},f=function(e){return function(t){var n=t.doc.nodeAt(e);return c(t.delete(e,e+n.nodeSize))}},p=function(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;var t={};return Object.keys(e.nodes).forEach((function(n){var i=e.nodes[n];i.spec.tableRole&&(t[i.spec.tableRole]=i)})),e.cached.tableNodeTypes=t,t},m=function(e,t){var n=e.index();return t instanceof r.Fragment?e.parent.canReplace(n,n,t):t instanceof r.Node&&e.parent.canReplaceWith(n,n,t.type)},h=function(e){return!e||"paragraph"===e.type.name&&2===e.nodeSize},v=function(e){return Object(a.findParentNodeClosestToPos)(e,(function(e){return e.type.spec.tableRole&&/table/i.test(e.type.spec.tableRole)}))},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t?e.createChecked(null,t):e.createAndFill()},g=function(e){return e[0].map((function(t,n){return e.map((function(e){return e[n]}))}))},_=function(e,t,n,i){var r=e>t?-1:1,o="Target position is invalid, you can't move the ".concat(i," ").concat(e," to ").concat(t,", the target can't be split. You could use tryToFit option.");if(1===r){if(-1!==n.slice(0,n.length-1).indexOf(t))throw new Error(o)}else if(-1!==n.slice(1).indexOf(t))throw new Error(o);return!0}},LAEe:function(e,t,n){"use strict";n.r(t),n.d(t,"pluginKey",(function(){return o})),n.d(t,"attachment",(function(){return a}));var i=n("GcJT"),r=Object.prototype.hasOwnProperty,o=new i.PluginKey("attachment");function a(e){var t=function(e){var t={};return["onDrop","onKeyDown"].forEach((function(n){r.call(e,n)&&"function"==typeof e[n]?t[n]=e[n]:t[n]=function(){return!1}})),t}(e),n=t.onDrop,a=t.onKeyDown;return new i.Plugin({key:o,state:{init:function(){return{}},apply:function(){return{}}},props:{handleDOMEvents:{drop:function(e,t){return n({view:e,event:t})}},handleKeyDown:function(e,t){return a({view:e,event:t})}}})}},LqeG:function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("7W2i"),f=n.n(d),p=n("a1gu"),m=n.n(p),h=n("Nsbk"),v=n.n(h),k=n("zJMb"),g=n("cy56"),_=n("V68o"),y=n("KY8K"),b=n("Cx/y"),x=n.n(b),w=n("ta2K"),N=n.n(w),O=n("AtFJ"),S=n.n(O),I=n("9Y8s"),j=n.n(I),T=n("G709"),A=n("P4HX"),E=n("b7+R"),$=n("vyVp");function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var D=function(e){f()(i,e);var t,n=M(i);function i(e){var t;return u()(this,i),(t=n.call(this,e)).acceptTypes=e.accept_types||[],t}return l()(i,[{key:"nodes",value:function(){return{image:{schema:{atom:!0,group:"block",inline:!1,selectable:!0,attrs:{filename:{default:void 0},url:{default:void 0},alttext:{default:void 0}},parseDOM:[{tag:"div.tui-wekaNodeImageBlock",getAttrs:E.getJsonAttrs},{tag:"div.tui-imageBlock",getAttrs:E.getJsonAttrs}],toDOM:function(e){return["div",{class:"tui-wekaNodeImageBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,alttext:e.attrs.alttext,url:e.attrs.url})}]}},component:x.a,componentContext:{replaceWithAttachment:this._replaceImageWithAttachment.bind(this),updateImage:this._updateImage.bind(this),hasAttachmentNode:this._hasAttachmentsNode.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}},video:{schema:{atom:!0,group:"block",inline:!1,attrs:{filename:{default:void 0},url:{default:void 0},mime_type:{default:void 0}},parseDOM:[{tag:"div.tui-wekaNodeVideoBlock",getAttrs:E.getJsonAttrs},{tag:"div.tui-videoBlock",getAttrs:E.getJsonAttrs}],toDOM:function(e){return["div",{class:"tui-wekaNodeVideoBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,url:e.attrs.url,mime_type:e.attrs.mime_type})}]}},component:N.a,componentContext:{replaceWithAttachment:this._replaceVideoWithAttachment.bind(this),hasAttachmentNode:this._hasAttachmentNode.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}},audio:{schema:{atom:!0,group:"block",inline:!1,attrs:{filename:{default:void 0},url:{default:void 0},mime_type:{default:void 0}},parseDOM:[{tag:"div.tui-wekaNodeAudioBlock",getAttrs:E.getJsonAttrs},{tag:"div.tui-audioBlock",getAttrs:E.getJsonAttrs}],toDOM:function(e){return["div",{class:"tui-wekaNodeAudioBlock","data-attrs":JSON.stringify({filename:e.attrs.filename,url:e.attrs.url,mime_type:e.attrs.mime_type})}]}},component:S.a,componentContext:{hasAttachmentNode:this._hasAttachmentNode.bind(this),replaceWithAttachment:this._replaceAudioWithAttachment.bind(this),removeNode:this.removeNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}}}}},{key:"toolbarItems",value:function(){var e=this;return this.editor.fileStorage.enabled?[new g.ToolbarItem({group:"embeds",label:Object(_.langString)("embedded_media","editor_weka"),iconComponent:j.a,execute:function(t){Object(y.pickFiles)(t).then(function(){var t=a()(r.a.mark((function t(n){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n&&e._startUploading(n);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})]:[]}},{key:"_startUploading",value:(t=a()(r.a.mark((function e(t){var n,i,o,a,s=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.editor.fileStorage.uploadFiles(t,this.acceptTypes);case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return");case 6:return i=this.editor.state.schema,e.next=9,Promise.all(n.map((function(e){var t=e.file,n=e.id,r=e.url;return Object(T.getMediaType)({filename:t,itemId:n}).then((function(e){var n=e.mediaType,o=e.mimeType;return A.IMAGE===n?i.node("image",{filename:t,alttext:"",url:r}):A.VIDEO===n?i.node("video",{filename:t,url:r,mime_type:o}):i.node("audio",{url:r,filename:t,mime_type:o})}))})));case 9:o=e.sent,this.editor.execute((function(e,t){var n=e.tr,r=n.selection;if(s._hasAttachmentsNode()){var a=i.nodes.attachments;if(r.$from.parent&&a.name===r.$from.parent.type.name)return n.insert(n.selection.$from.after(),o),void t(n)}if(r.empty){var u=r.$from,c=u.parent;"paragraph"===c.type.name&&0===c.content.size?(n.replaceWith(u.before(),u.after(),o),s.editor.view.focus()):n.insert(u.pos,o)}else n.replaceWith(r.from,r.to,o);t(n)})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0),e.t0 instanceof y.UploadError?Object($.notify)({type:"error",message:e.t0.message}):(a=Object(_.langString)("error_upload_failed","editor_weka"),Object(_.loadLangStrings)([a]).then((function(){return Object($.notify)({type:"error",message:a.toString()})})));case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return t.apply(this,arguments)})},{key:"_replaceImageWithAttachment",value:function(e,t){var n=this,i=t.filename,r=t.alttext,o=t.size;this.editor.execute((function(t,a){var s=t.tr,u=e(),c=t.schema.node("attachment",{filename:i,url:n._getFileUrl(i),size:o,option:{alttext:r}});a(s.replaceWith(u.from,u.to,t.schema.node("attachments",null,[c])))}))}},{key:"_replaceVideoWithAttachment",value:function(e,t){var n=this,i=t.filename,r=t.size;this.editor.execute((function(t,o){var a=t.tr,s=e(),u=t.schema.node("attachment",{filename:i,url:n._getFileUrl(i),size:r,option:{}});o(a.replaceWith(s.from,s.to,t.schema.node("attachments",null,[u])))}))}},{key:"_updateImage",value:function(e,t){var n=this,i=t.filename,r=t.alttext;this.editor.execute((function(t,o){var a=t.tr,s=e(),u=t.schema.node("image",{filename:i,url:n._getFileUrl(i),alttext:r});o(a.replaceWith(s.from,s.to,u)),n.editor.view.focus()}))}},{key:"_replaceAudioWithAttachment",value:function(e,t){var n=this,i=t.filename,r=t.size;this.editor.execute((function(t,o){var a=t.tr,s=e(),u=t.schema.node("attachment",{filename:i,url:n._getFileUrl(i),size:r,option:{}});o(a.replaceWith(s.from,s.to,t.schema.node("attachments",null,[u])))}))}},{key:"_hasAttachmentNode",value:function(){return this.editor.hasNode("attachment")}},{key:"_hasAttachmentsNode",value:function(){return this.editor.hasNode("attachments")}},{key:"_getFileUrl",value:function(e){var t=this.editor.fileStorage.getFile(e);return t?t.url:null}},{key:"_getItemId",value:function(){return this.editor.fileStorage.getFileStorageItemId()}}]),i}(k.default);t.default=function(e){return new D(e)}},Mnur:function(e,t){e.exports=tui.require("tui/components/modal/ModalPresenter")},Nfo2:function(e,t){e.exports=tui.require("editor_weka/components/nodes/LinkBlock")},NqIU:function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("H/tB"),u=n.n(s),c=n("TXEh"),l=n("5vO2"),d=n("z2s3"),f=n.n(d),p=n("V68o"),m={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_weka"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"component"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_component"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"area"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_area"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"instance_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"draft_id"}},type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"editor"},name:{kind:"Name",value:"editor_weka_editor"},arguments:[{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}},{kind:"Argument",name:{kind:"Name",value:"instance_id"},value:{kind:"Variable",name:{kind:"Name",value:"instance_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"showtoolbar"},arguments:[{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"extensions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"Variable",name:{kind:"Name",value:"component"}}},{kind:"Argument",name:{kind:"Name",value:"area"},value:{kind:"Variable",name:{kind:"Name",value:"area"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tuicomponent"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"context_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_data"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repository_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"files"},arguments:[{kind:"Argument",name:{kind:"Name",value:"component"},value:{kind:"StringValue",value:"user",block:!1}},{kind:"Argument",name:{kind:"Name",value:"file_area"},value:{kind:"StringValue",value:"draft",block:!1}},{kind:"Argument",name:{kind:"Name",value:"item_id"},value:{kind:"Variable",name:{kind:"Name",value:"draft_id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[{kind:"Argument",name:{kind:"Name",value:"force_download"},value:{kind:"BooleanValue",value:!0}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]}]}}]}}]}}]},h=n("7gPm"),v=n("w52A"),k=n("9iry"),g=function(e,t){return JSON.stringify(t)==JSON.stringify(e)},_=function(e){return Object(k.createImmutablePropWatcher)("Weka",e,g)},y={components:{Toolbar:f.a},props:{placeholder:{type:String,default:""},instanceId:[Number,String],fileItemId:[Number,String],component:String,area:String,options:{type:Object,validator:function(e){return void 0!==e.showtoolbar&&void 0!==e.extensions}},value:v.default},data:function(){return{toolbarItems:[],toolbarEnabled:!1}},computed:{showToolbar:function(){return!!this.toolbarEnabled&&this.toolbarItems.length>0}},watch:{value:function(e){this.displayedValue!==e&&(this.displayedValue=e||v.default.empty(),this.editor&&this.editor.setValue(this.displayedValue))},component:_("component"),area:_("area"),instanceId:_("instanceId"),options:_("options"),fileItemId:function(e){this.editor.updateFileItemId(e)}},created:function(){this.updateToolbarThrottled=Object(c.throttle)(this.updateToolbar,100),this.value?this.displayedValue=this.value:this.displayedValue=v.default.empty(),this.finalOptions=null},mounted:function(){this.createEditor()},beforeDestroy:function(){this.editor&&this.editor.destroy()},methods:{setupOptions:function(){var e=this;return a()(r.a.mark((function t(){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.options){t.next=4;break}return e.finalOptions=Object.assign({},e.options),e.toolbarEnabled=e.finalOptions.showtoolbar,t.abrupt("return");case 4:return t.next=6,e.$apollo.query({query:m,fetchPolicy:"no-cache",variables:{instance_id:e.instanceId,component:e.component,area:e.area,draft_id:e.fileItemId}});case 6:n=t.sent,e.finalOptions=Object.assign({},n.data.editor),e.toolbarEnabled=e.finalOptions.showtoolbar;case 9:case"end":return t.stop()}}),t)})))()},getExtensions:function(){var e=this;return a()(r.a.mark((function t(){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setupOptions();case 2:if(n=[],!Array.isArray(e.finalOptions.extensions)){t.next=7;break}return t.next=6,Promise.all(e.finalOptions.extensions.map((function(e){var t=e.tuicomponent,n=e.options,i={};return null!=n&&(i=JSON.parse(n)),u.a.import(t).then((function(e){return e.default(i)}))})));case 6:n=t.sent;case 7:return t.abrupt("return",n);case 8:case"end":return t.stop()}}),t)})))()},getRepositoryData:function(){var e=this;return a()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setupOptions();case 2:return t.abrupt("return",e.finalOptions.repository_data||null);case 3:case"end":return t.stop()}}),t)})))()},getCurrentFiles:function(){var e=this;return a()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setupOptions();case 2:return t.abrupt("return",e.finalOptions.files||[]);case 3:case"end":return t.stop()}}),t)})))()},createEditor:function(){var e=this;return a()(r.a.mark((function t(){var n,i,o,a,s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.editor){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.getExtensions();case 4:return n=t.sent,t.next=7,e.getRepositoryData();case 7:return i=t.sent,o=new h.default({itemId:e.fileItemId,contextId:e.finalOptions.context_id||null}),null!==i&&o.setRepositoryData(i),t.next=12,e.getCurrentFiles();case 12:return a=t.sent,Array.prototype.forEach.call(a,(function(e){var t=e.filename,n=e.url,i=e.file_size;o.addFile({file:t,url:n,size:i})})),e.editor=new l.default({value:e.displayedValue,placeholder:e.placeholder,parent:e,viewExtrasEl:e.$refs.extras,viewExtrasLiveEl:e.$refs.extrasLive,extensions:n,fileStorage:o,onUpdate:e.$_onUpdate.bind(e),onTransaction:function(){e.updateToolbarThrottled()},onFocus:function(t){e.$emit("focus",t)},onBlur:function(t){e.$emit("blur",t)}}),s=e.editor.allVueComponents(),t.next=18,Promise.all([u.a.loadRequirements({components:s}),Object(p.loadLangStrings)(e.editor.allStrings())]);case 18:e.view=e.editor.createView(e.$refs.editorHost),e.updateToolbar(),e.$emit("ready");case 21:case"end":return t.stop()}}),t)})))()},updateToolbar:function(){this.toolbarItems=this.editor.getToolbarItems()},$_onUpdate:function(e){this.displayedValue=e,this.$emit("input",e)}}},b=(n("gTrn"),n("KHd+")),x=Object(b.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-weka no-yui-ids",attrs:{id:e.uid}},[e.showToolbar?n("Toolbar",{attrs:{items:e.toolbarItems}}):e._e(),e._v(" "),n("div",{ref:"editorHost",staticClass:"tui-weka__editorHost tui-rendered",attrs:{"data-placeholder":e.placeholder}}),e._v(" "),n("div",{ref:"extras"}),e._v(" "),n("div",{ref:"extrasLive",attrs:{"aria-live":"polite",role:"status"}})],1)}),[],!1,null,null,null);x.options.__hasBlocks={script:!0,template:!0};t.default=x.exports},Nsbk:function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},O5Oz:function(e,t){e.exports=tui.require("editor_weka/components/editing/EmojiSelector")},OWva:function(e,t){e.exports=tui.require("editor_weka/components/editing/PositionedActionDropdown")},OxlY:function(e,t){e.exports=tui.require("editor_weka/components/editing/EditLinkModal")},P4HX:function(e,t,n){"use strict";n.r(t),n.d(t,"IMAGE",(function(){return i})),n.d(t,"VIDEO",(function(){return r})),n.d(t,"AUDIO",(function(){return o}));var i="IMAGE",r="VIDEO",o="AUDIO"},PJYZ:function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},PvNB:function(e,t){e.exports=tui.require("ext_prosemirror/gapcursor")},QCX9:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Emoji")},RNtj:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AttachmentNode")},S8bZ:function(e,t){e.exports=tui.require("tui/components/errors/ErrorPageRender")},S8i7:function(e,t){},SIrR:function(e,t,n){!function(){"use strict";"undefined"!=typeof tui&&tui._bundle.isLoaded("editor_weka")?console.warn('[tui bundle] The bundle "editor_weka" is already loaded, skipping initialisation.'):(tui._bundle.register("editor_weka"),tui._bundle.addModulesFromContext("editor_weka",n("dxp4")),tui._bundle.addModulesFromContext("editor_weka/components",n("6gLU")),tui._bundle.addModulesFromContext("editor_weka/pages",n("j1CR")))}()},SeWd:function(e,t,n){"use strict";n.r(t),n.d(t,"buildKeymap",(function(){return s}));var i=n("zTcH"),r=n("XAXS"),o=n("v+xu"),a="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function s(e,t){var n={};function s(e,t){n[e]=t}s("Mod-z",r.undo),s("Shift-Mod-z",r.redo),s("Backspace",o.undoInputRule),a||s("Mod-y",r.redo),s("Alt-ArrowUp",i.joinUp),s("Alt-ArrowDown",i.joinDown),s("Mod-BracketLeft",i.lift),s("Escape",i.selectParentNode);var u={schema:e,isMac:a};return t.forEach((function(e){e(s,u)})),n}},SksO:function(e,t){function n(t,i){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,i)}e.exports=n},T27E:function(e,t,n){"use strict";n.r(t);var i=n("gLvT"),r=n.n(i),o=n("3sQR"),a=n.n(o),s={components:{Dropdown:r.a,DropdownButton:a.a},props:{position:String,open:Boolean,actions:Array}},u=n("KHd+"),c=Object(u.a)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Dropdown",{attrs:{position:e.position,open:e.open},on:{dismiss:function(t){return e.$emit("dismiss")}},scopedSlots:e._u([{key:"trigger",fn:function(t){return[e._t("trigger",null,null,t)]}}],null,!0)},[e._v(" "),e._t("dropdown-items",e._l(e.actions,(function(t,i){return n("DropdownButton",{key:i,on:{click:function(e){return e.preventDefault(),t.action()}}},[e._v("\n      "+e._s(t.label)+"\n    ")])})))],2)}),[],!1,null,null,null);c.options.__hasBlocks={script:!0,template:!0};t.default=c.exports},"TGM/":function(e,t){e.exports=tui.require("tui/pending")},TNgD:function(e,t,n){"use strict";n.r(t);var i={props:{nodeInfo:Object,contextInfo:Object,updateAttrs:Function,replaceWith:Function,getPos:Function,getRange:Function},computed:{node:function(){return this.nodeInfo.node},attrs:function(){return this.nodeInfo.node.attrs},context:function(){return this.contextInfo.context}}},r=n("KHd+"),o=Object(r.a)(i,void 0,void 0,!1,null,null,null);o.options.__hasBlocks={script:!0,template:!1};t.default=o.exports},TXEh:function(e,t){e.exports=tui.require("tui/util")},TZft:function(e,t,n){"use strict";n.r(t);var i=n("5h9J"),r=n.n(i),o=n("QCX9"),a=n.n(o),s={components:{ButtonIcon:r.a,Emoji:a.a},props:{emojis:{type:Array,required:!0,validator:function(e){return e.every((function(e){return"shortcode"in e}))}}},methods:{select:function(e){this.$emit("emoji-selected",e)},fromShortCode:function(e){return String.fromCodePoint("0x"+e)}}},u=(n("oWLq"),n("KHd+")),c=Object(u.a)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaEmojiSelector"},e._l(e.emojis,(function(t,i){return n("ButtonIcon",{key:i,attrs:{styleclass:{stealth:!0},"aria-label":e.fromShortCode(t.shortcode)},nativeOn:{click:function(n){return e.select(t)}}},[n("Emoji",{staticClass:"tui-wekaEmojiSelector__emoji",attrs:{"short-code":t.shortcode}})],1)})),1)}),[],!1,null,null,null);c.options.__hasBlocks={script:!0,template:!0};t.default=c.exports},TnOg:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("/7YT"),u=n("i7/w"),c=n.n(u),l=n("wq8e"),d=n("W9VI"),f=n("aBJ+"),p=n("mB48"),m=n("pynp"),h=n.n(m),v=function(){function e(t){r()(this,e),this._instance=null,this._editor=t,this._updatePosition=this._updatePosition.bind(this)}return a()(e,[{key:"matcher",value:function(e,t){if(!(t&&t instanceof s.ResolvedPos))return null;var n,i=t.doc.textBetween(t.start(),t.end(),"\0","\0");if(""===i)return null;for(e.lastIndex=0;n=e.exec(i);){var r=n.input.slice(Math.max(0,n.index-1),n.index);if(/^[\s\0]?$/.test(r)){var o=n.index+t.start(),a=o+n[0].length;if(o<t.pos&&a>=t.pos)return{range:{from:o,to:a},text:n[0]}}}return null}},{key:"destroyInstance",value:function(){var e=this;this._scrollableContainers&&(this._scrollableContainers.forEach((function(t){return t.removeEventListener("scroll",e._updatePosition)})),this._scrollableContainers=null),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),null!==this._instance&&(this._instance.$destroy(),this._editor.viewExtrasLiveEl.removeChild(this._instance.$el),this._instance=null)}},{key:"resetComponent",value:function(){return{apply:!1,text:"",from:0,to:0}}},{key:"showList",value:function(e){var t=this,n=e.view,i=e.component,r=e.state,o=r.range,a=r.text,s=e.callback;null!==this._instance&&this.destroyInstance();var u=document.createElement("span");this._editor.viewExtrasLiveEl.appendChild(u),this._view=n,this._range=o,this._location=c.a.observable(this._getLocation()),this._instance=new(c.a.extend(i.component))({parent:this._editor.getParent(),propsData:{location:this._location,pattern:a}}),this._instance.$mount(u),this._scrollableContainers=[];for(var d=Object(l.getClosestScrollable)(this._editor.viewExtrasLiveEl);d;)this._scrollableContainers.push(d),d.addEventListener("scroll",this._updatePosition),d=Object(l.getClosestScrollable)(d.parentNode);this._scrollableContainers.push(document),document.addEventListener("scroll",this._updatePosition),this._resizeObserver=new h.a(this._updatePosition),this._resizeObserver.observe(this._instance.$el),this._instance.$on("item-selected",(function(e){var r=e.id,a=e.text;t.destroyInstance();var u=t.getNode(n.state,i.name,i.attrs(r,a));t.convertToNode(o,u),"function"==typeof s&&s()})),this._instance.$on("dismiss",(function(){t.destroyInstance(),t._editor.view.focus()})),c.a.nextTick(this._updatePosition)}},{key:"_updatePosition",value:function(){Object.assign(this._location,this._getLocation())}},{key:"_getLocation",value:function(){var e=document.documentElement,t=Object(p.getBoundingClientRect)(this._editor.viewExtrasLiveEl.offsetParent),n=this._view.coordsAtPos(this._range.from),i=f.Rect.fromPositions(Object.assign({},n,{right:n.right+1})).sub(t.getPosition()),r=new f.Rect(0,0,e.clientWidth,e.clientHeight).sub(t.getPosition()),o=Object(d.position)({position:["bottom","left"],ref:i,viewport:r,size:this._instance?new f.Size(this._instance.$el.offsetWidth,this._instance.$el.offsetHeight):new f.Size(50,50),padding:0});return{x:o.location.x,y:o.location.y}}},{key:"getNode",value:function(e,t,n){return e.schema.node(t,n)}},{key:"convertToNode",value:function(e,t){var n=this;this._editor.execute((function(i,r){r(n.createTransaction(i,e,t)),n._editor.view.focus()}))}},{key:"createTransaction",value:function(e,t,n){var i=e.tr;return i=i.replaceWith(t.from,t.to,n)}},{key:"apply",value:function(e,t,n,i){var r=e.selection,o=Object.assign({},t);if(r.from===r.to){var a=this.matcher(n,r.$from);if(a)return o.active=!0,o.range=a.range,o.text=a.text,i&&(i.text=a.text,i.from=a.range.from,i.to=a.range.to),o}return o.active=!1,o.range={},o.text=null,o}}]),e}()},U9km:function(e,t,n){"use strict";n.r(t),n.d(t,"SetAttrsStep",(function(){return g})),n.d(t,"setAttrs",(function(){return _}));var i=n("cDf5"),r=n.n(i),o=n("lwsE"),a=n.n(o),s=n("W8MJ"),u=n.n(s),c=n("7W2i"),l=n.n(c),d=n("a1gu"),f=n.n(d),p=n("Nsbk"),m=n.n(p),h=n("/7YT"),v=n("CksW");function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=m()(e);if(t){var r=m()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return f()(this,n)}}var g=function(e){l()(n,e);var t=k(n);function n(e,i){var r;return a()(this,n),(r=t.call(this)).pos=e,r.attrs=i,r}return u()(n,[{key:"apply",value:function(e){var t=e.nodeAt(this.pos);if(!t)return v.StepResult.fail("No node at given position");var n=t.type.create(this.attrs,h.Fragment.empty,t.marks),i=new h.Slice(h.Fragment.from(n),0,t.isLeaf?0:1);return v.StepResult.fromReplace(e,this.pos,this.pos+t.nodeSize,i)}},{key:"invert",value:function(e){var t=e.nodeAt(this.pos);return new n(this.pos,t?t.attrs:null)}},{key:"map",value:function(e){var t=e.mapResult(this.pos,1);return t.deleted?null:new n(t.pos,this.attrs)}},{key:"toJSON",value:function(){return{stepType:"setAttrs",pos:this.pos,attrs:this.attrs}}}],[{key:"fromJSON",value:function(e,t){if("number"!=typeof t.pos||null!=t.attrs&&"object"!=r()(t.attrs))throw new RangeError("Invalid input for SetAttrsStep.fromJSON");return new n(t.pos,t.attrs)}}]),n}(v.Step);v.Step.jsonID("setAttrs",g);var _=function(e,t){return function(n){return n.step(new g(e,t))}}},UpZR:function(e,t){e.exports=tui.require("tui/apollo_client")},UwCb:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("zJMb"),m=n("V68o"),h=n("cy56"),v=n("/uQ1"),k=n("YVua"),g=n("v+xu"),_=n("3qPy"),y=n.n(_),b=n("90QZ"),x=n.n(b);function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var N=["ol",0],O=["ul",0],S=["li",0],I=function(e){u()(n,e);var t=w(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{bullet_list:{schema:{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:function(){return O}}},ordered_list:{schema:{content:"list_item+",group:"block",attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:function(e){return{order:e.hasAttribute("start")?+e.getAttribute("start"):1}}}],toDOM:function(e){return 1==e.attrs.order?N:["ol",{start:e.attrs.order},0]}}},list_item:{schema:{content:"paragraph block*",parseDOM:[{tag:"li"}],toDOM:function(){return S},defining:!0,draggable:!1}}}}},{key:"toolbarItems",value:function(){var e=this.getSchema().nodes,t=e.bullet_list,n=e.ordered_list,i=e.list_item,r=[t,n];return[Object(h.cmdItem)(Object(v.toggleList)(t,i,r),{group:"text",label:Object(m.langString)("bulletlist","editor"),iconComponent:x.a,active:function(e){return Object(v.isListActive)(e.state,t)}}),Object(h.cmdItem)(Object(v.toggleList)(n,i,r),{group:"text",label:Object(m.langString)("numberedlist","editor"),iconComponent:y.a,active:function(e){return Object(v.isListActive)(e.state,n)}})]}},{key:"keymap",value:function(e){var t=this.getSchema().nodes,n=t.bullet_list,i=t.ordered_list,r=t.list_item,o=[n,i];e("Shift-Ctrl-8",Object(v.toggleList)(n,r,o)),e("Shift-Ctrl-9",Object(v.toggleList)(i,r,o)),e("Enter",Object(k.splitListItem)(r)),e("Shift-Tab",Object(k.liftListItem)(r)),e("Tab",Object(k.sinkListItem)(r))}},{key:"inputRules",value:function(){var e,t=this.getSchema().nodes,n=t.bullet_list,i=t.ordered_list;return[(e=n,Object(g.wrappingInputRule)(/^\s*([-+*])\s$/,e)),j(i)]}}]),n}(p.default);function j(e){return Object(g.wrappingInputRule)(/^(\d+)\.\s$/,e,(function(e){return{order:+e[1]}}),(function(e,t){return t.childCount+t.attrs.order==+e[1]}))}t.default=function(e){return new I(e)}},V68o:function(e,t){e.exports=tui.require("tui/i18n")},VR8M:function(e,t,n){"use strict";n.r(t),n.d(t,"removeParentNodeOfType",(function(){return s})),n.d(t,"replaceParentNodeOfType",(function(){return u})),n.d(t,"removeSelectedNode",(function(){return c})),n.d(t,"replaceSelectedNode",(function(){return l})),n.d(t,"setTextSelection",(function(){return d})),n.d(t,"safeInsert",(function(){return m})),n.d(t,"setParentNodeMarkup",(function(){return h})),n.d(t,"selectParentNodeOfType",(function(){return v})),n.d(t,"removeNodeBefore",(function(){return k}));var i=n("GcJT"),r=n("/7YT"),o=n("D7iR"),a=n("Ko4C"),s=function(e){return function(t){var n=Object(o.findParentNodeOfType)(e)(t.selection);return n?Object(a.removeNodeAtPos)(n.pos)(t):t}},u=function(e,t){return function(n){Array.isArray(e)||(e=[e]);for(var i=0,r=e.length;i<r;i++){var s=Object(o.findParentNodeOfType)(e[i])(n.selection);if(s){var u=Object(a.replaceNodeAtPos)(s.pos,t)(n);if(u!==n)return u}}return n}},c=function(e){if(Object(a.isNodeSelection)(e.selection)){var t=e.selection.$from.pos,n=e.selection.$to.pos;return Object(a.cloneTr)(e.delete(t,n))}return e},l=function(e){return function(t){if(Object(a.isNodeSelection)(t.selection)){var n=t.selection,o=n.$from,s=n.$to;if(e instanceof r.Fragment&&o.parent.canReplace(o.index(),o.indexAfter(),e)||o.parent.canReplaceWith(o.index(),o.indexAfter(),e.type))return Object(a.cloneTr)(t.replaceWith(o.pos,s.pos,e).setSelection(new i.NodeSelection(t.doc.resolve(o.pos))))}return t}},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(n){var r=i.Selection.findFrom(n.doc.resolve(e),t,!0);return r?n.setSelection(r):n}},f=function(e){return e.type&&e.type.spec.selectable},p=function(e,t,n){return function(e){return f(e)&&e.type.isLeaf}(e)?n.setSelection(new i.NodeSelection(n.doc.resolve(t))):d(t)(n)},m=function(e,t,n){return function(i){var r="number"==typeof t,o=i.selection.$from,s=r?i.doc.resolve(t):Object(a.isNodeSelection)(i.selection)?i.doc.resolve(o.pos+1):o,c=s.parent;if(Object(a.isNodeSelection)(i.selection)&&n&&i!==(i=l(e)(i)))return i;if(Object(a.isEmptyParagraph)(c)&&i!==(i=u(c.type,e)(i))){var d=f(e)?s.before(s.depth):s.pos;return p(e,d,i)}if(Object(a.canInsert)(s,e)){i.insert(s.pos,e);var m=r?s.pos:f(e)?i.selection.$anchor.pos-1:i.selection.$anchor.pos;return Object(a.cloneTr)(p(e,m,i))}for(var h=s.depth;h>0;h--){var v=s.after(h),k=i.doc.resolve(v);if(Object(a.canInsert)(k,e))return i.insert(v,e),Object(a.cloneTr)(p(e,v,i))}return i}},h=function(e,t,n,i){return function(r){var s=Object(o.findParentNodeOfType)(e)(r.selection);return s?Object(a.cloneTr)(r.setNodeMarkup(s.pos,t,Object.assign({},s.node.attrs,n),i)):r}},v=function(e){return function(t){if(!Object(a.isNodeSelection)(t.selection)){var n=Object(o.findParentNodeOfType)(e)(t.selection);if(n)return Object(a.cloneTr)(t.setSelection(i.NodeSelection.create(t.doc,n.pos)))}return t}},k=function(e){var t=Object(o.findPositionOfNodeBefore)(e.selection);return"number"==typeof t?Object(a.removeNodeAtPos)(t)(e):e}},VSrT:function(e,t){},W8MJ:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.exports=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}},W9VI:function(e,t){e.exports=tui.require("tui/lib/popover")},WF6d:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),r=n.n(i),o=n("hg2Q"),a=n("P4HX"),s=n("D3bS"),u=n.n(s),c=n("+xcZ"),l=n.n(c),d=n("GqWi"),f=n.n(d),p=n("jHsM"),m=n.n(p),h={components:{ImageAttachment:u.a,FileAttachment:l.a,VideoAttachment:f.a,AudioAttachment:m.a},extends:r.a,apollo:{file:{query:o.a,variables:function(){return{item_id:this.itemId,filename:this.filename}}}},data:function(){return{file:{}}},computed:{isImage:function(){return this.file&&this.file.media_type===a.IMAGE},isVideo:function(){return this.file&&this.file.media_type===a.VIDEO},isAudio:function(){return this.file&&this.file.media_type===a.AUDIO},itemId:function(){if(!this.context.getItemId)throw new Error("There is no function 'getItemId'");return this.context.getItemId()},filename:function(){var e=this.attrs;return e.filename?e.filename:this.$str("unknown_attachment","editor_weka")},option:function(){return this.attrs.option?this.attrs.option:{}},hasImageNode:function(){return!!this.context.hasImageNode&&this.context.hasImageNode()},hasVideoNode:function(){return!!this.context.hasVideoNode&&this.context.hasVideoNode()},hasAudioNode:function(){return!!this.context.hasAudioNode&&this.context.hasAudioNode()},downloadUrl:function(){if(!this.context.getFileUrl)return null;var e=this.context.getFileUrl(this.filename);return e?this.$url(e):null}},methods:{toImage:function(){if(this.context.convertToImage){var e={filename:this.filename,alttext:this.option.alttext||null};this.context.convertToImage(this.getRange,e)}},updateAltText:function(e){this.$_updateNode({filename:this.filename,size:this.file?this.file.file_size:this.attrs.size,option:{alttext:e}})},$_updateNode:function(e){this.context.updateNode&&this.context.updateNode(this.getRange,e)},toVideo:function(){if(this.context.convertToVideo){var e={filename:this.filename,mimeType:this.file.mime_type};this.context.convertToVideo(this.getRange,e)}},toAudio:function(){if(this.context.convertToAudio){var e={filename:this.filename,mimeType:this.file.mime_type};this.context.convertToAudio(this.getRange,e)}},removeNode:function(){this.context.removeNode&&this.context.removeNode(this.getRange)},download:function(){var e=this.downloadUrl;e&&(window.document.location.href=e)}}},v=(n("AT4M"),n("KHd+")),k=function(e){e.options.__langStrings={editor_weka:["unknown_attachment"]}},g=Object(v.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaAttachment"},[e.$apollo.loading?e._e():[e.isImage?n("ImageAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"alt-text":e.option.alttext||null,"enable-convert":e.hasImageNode,"has-download-url":!!e.downloadUrl},on:{"convert-to-embedded-media":e.toImage,"update-alt-text":e.updateAltText,delete:e.removeNode,download:e.download}}):e.isVideo?n("VideoAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"enable-convert":e.hasVideoNode,"has-download-url":!!e.downloadUrl},on:{"convert-to-embedded-media":e.toVideo,delete:e.removeNode,download:e.download}}):e.isAudio?n("AudioAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,"draft-id":e.itemId,filename:e.filename,"enable-convert":e.hasAudioNode,"has-download-url":!!e.downloadUrl},on:{"convert-to-embedded-media":e.toAudio,delete:e.removeNode,download:e.download}}):n("FileAttachment",{attrs:{"file-size":e.file?e.file.file_size:0,filename:e.filename,"draft-id":e.itemId,"has-download-url":!!e.downloadUrl},on:{delete:e.removeNode,download:e.download}})]],2)}),[],!1,null,null,null);"function"==typeof k&&k(g),g.options.__hasBlocks={script:!0,template:!0};t.default=g.exports},Wdod:function(e,t){e.exports=tui.require("editor_weka/components/upload/FilePicker")},WkPL:function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}},"WwJ/":function(e,t,n){"use strict";n.r(t);var i=n("36rR"),r=n("gLvT"),o=n.n(r),a=n("KGcv"),s=n.n(a),u=n("ixxs"),c=n.n(u),l=n("vF5l"),d=n.n(l),f=n("9Ovj"),p=n.n(f),m=n("EzMw"),h=n.n(m),v=n("9G+f"),k=n.n(v),g={components:{Dropdown:o.a,DropdownItem:s.a,ShowIcon:c.a,Button:d.a,ToolbarButton:p.a,ToolbarButtonIcon:h.a,Popover:k.a},props:{items:{type:Array}},computed:{activeBlockName:function(){var e=this.blockItems.find((function(e){return e.active}));return e?e.label.toString():"Block"},blockSelectorEnabled:function(){return this.blockItems.some((function(e){return e.enabled}))},blockItems:function(){return this.items.filter((function(e){return"blocks"==e.group}))},itemGroups:function(){var e=this.items.filter((function(e){return"blocks"!=e.group})),t={text:[],embeds:[]};return e.forEach((function(e){t[e.group]||(t[e.group]=[]),t[e.group].push(e)})),t}},methods:{itemClick:function(e){e.enabled&&e.execute&&e.execute()},openChanged:function(e,t){!t&&e.enabled&&e.reset&&e.reset()},handleButtonKeydown:function(e){var t=e.currentTarget;switch(e.key){case"ArrowLeft":case"Left":this.$_moveFocus(t,"prev");break;case"ArrowRight":case"Right":this.$_moveFocus(t,"next");break;case"Home":this.$_moveFocus(t,"first");break;case"End":this.$_moveFocus(t,"last");break;default:return}e.stopPropagation(),e.preventDefault()},handleButtonFocus:function(e){var t=e.currentTarget;this.$_getAllButtons().forEach((function(e){e.tabIndex=e==t?0:-1}))},$_getAllButtons:function(){return Array.prototype.slice.call(this.$el.querySelectorAll(".tui-wekaToolbar__button"))},$_moveFocus:function(e,t){var n=Object(i.getTabbableElements)(this.$el),r=this.$_getAllButtons().filter((function(e){return n.includes(e)})),o=r.length-1,a=0;"prev"==t||"next"==t?-1==(a=r.indexOf(e))?a="next"==t?o:0:(a+="next"==t?1:-1)>o?a=0:a<0&&(a=o):"first"==t?a=0:"last"==t&&(a=o),r[a]&&r[a].focus()}}},_=(n("It5U"),n("KHd+")),y=function(e){e.options.__langStrings={editor_weka:["format_as_blocktype_status","label_toolbar"]}},b=Object(_.a)(g,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaToolbar",attrs:{role:"toolbar","aria-label":e.$str("label_toolbar","editor_weka")}},[n("div",{staticClass:"tui-wekaToolbar__group"},[n("Dropdown",{attrs:{separator:!1},scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,r=t.isOpen;return[n("ToolbarButton",{staticClass:"tui-wekaToolbar__currentBlock tui-wekaToolbar__button",attrs:{text:e.activeBlockName,"aria-expanded":r?"true":"false","aria-label":e.$str("format_as_blocktype_status","editor_weka",e.activeBlockName),disabled:!e.blockSelectorEnabled,caret:""},on:{click:function(e){return i()}},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}})]}}])},[e._v(" "),e._l(e.blockItems,(function(t,i){return n("DropdownItem",{key:i,attrs:{selected:t.active,disabled:!t.active&&!t.enabled},on:{click:function(n){return e.itemClick(t)}}},[e._v("\n        "+e._s(t.label.toString())+"\n      ")])}))],2)],1),e._v(" "),e._l(e.itemGroups,(function(t,i){return n("div",{key:i,staticClass:"tui-wekaToolbar__group"},[e._l(t,(function(t,i){return[t.children?n("Dropdown",{key:i,attrs:{separator:!1},scopedSlots:e._u([{key:"trigger",fn:function(i){var r=i.toggle;return[n("ToolbarButtonIcon",{staticClass:"tui-wekaToolbar__button",attrs:{text:t.label.toString(),active:t.active,disabled:!t.enabled},on:{click:r},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n(t.iconComponent,{tag:"component"})],1)],2)]}}],null,!0)},[e._v(" "),e._l(t.children,(function(t,i){return n("DropdownItem",{key:i,attrs:{disabled:!t.enabled},on:{click:function(n){return e.itemClick(t)}}},[n(t.iconComponent,{tag:"component"}),e._v("\n          "+e._s(t.label.toString())+"\n        ")],1)}))],2):t.popover?n("Popover",{key:i,attrs:{triggers:["click"],title:t.popover.title},on:{"open-changed":function(n){for(var i=arguments.length,r=Array(i);i--;)r[i]=arguments[i];return e.openChanged.apply(void 0,[t].concat(r))}},scopedSlots:e._u([{key:"trigger",fn:function(i){var r=i.isOpen;return[n("ToolbarButtonIcon",{staticClass:"tui-wekaToolbar__button",attrs:{text:t.label.toString(),selected:t.active,disabled:!t.enabled,"aria-haspopup":"true","aria-expanded":r?"true":"false"},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n(t.iconComponent,{tag:"component"})],1)],2)]}},{key:"default",fn:function(e){var i=e.close;return[n(t.popover.component,{tag:"component",on:{close:i}})]}}],null,!0)}):n("ToolbarButtonIcon",{key:i,staticClass:"tui-wekaToolbar__button",attrs:{text:t.label.toString(),selected:t.active,disabled:!t.enabled},on:{click:function(n){return e.itemClick(t)}},nativeOn:{keydown:function(t){return e.handleButtonKeydown(t)},focus:function(t){return e.handleButtonFocus(t)}}},[n("template",{slot:"icon"},[n(t.iconComponent,{tag:"component"})],1)],2)]}))],2)}))],2)}),[],!1,null,null,null);"function"==typeof y&&y(b),b.options.__hasBlocks={script:!0,template:!0};t.default=b.exports},X5W2:function(e,t){},XAXS:function(e,t){e.exports=tui.require("ext_prosemirror/history")},XS2e:function(e,t,n){"use strict";n.r(t);var i=n("nEm4"),r=n.n(i),o=n("tkAW"),a=n.n(o),s=n("u5iS"),u=n.n(s),c=n("oMuj"),l=n.n(c),d=n("BN8m"),f=n.n(d),p=n("vF5l"),m=n.n(p),h=n("nXMa"),v=n.n(h),k={components:{Modal:a.a,ModalContent:u.a,Form:r.a,InputText:l.a,ButtonGroup:f.a,Button:m.a,ButtonCancel:v.a},props:{value:{type:String,required:!0}},data:function(){return{innerValue:this.value}},computed:{modalTitle:function(){return 0===this.value.length?this.$str("add_image_alt_text","editor_weka"):this.$str("edit_image_alt_text","editor_weka")}},methods:{confirm:function(){this.$emit("change",this.innerValue)}}},g=(n("laAb"),n("KHd+")),_=function(e){e.options.__langStrings={editor_weka:["add_image_alt_text","edit_image_alt_text","done","image_alt_help"]}},y=Object(g.a)(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{staticClass:"tui-wekaEditImageAltTextModal"},[n("ModalContent",{staticClass:"tui-wekaEditImageAltTextModal__content",attrs:{title:e.modalTitle}},[n("Form",{on:{submit:function(t){return t.preventDefault(),e.confirm(t)}}},[n("div",{staticClass:"tui-wekaEditImageAltTextModal__input"},[n("InputText",{attrs:{autofocus:!0},model:{value:e.innerValue,callback:function(t){e.innerValue=t},expression:"innerValue"}}),e._v(" "),n("p",{staticClass:"tui-wekaEditImageAltTextModal__input-helpText"},[e._v("\n          "+e._s(e.$str("image_alt_help","editor_weka"))+"\n        ")])],1),e._v(" "),n("ButtonGroup",{staticClass:"tui-wekaEditImageAltTextModal__buttonGroup"},[n("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("done","editor_weka")},on:{click:e.confirm}}),e._v(" "),n("ButtonCancel",{on:{click:function(t){return t.preventDefault(),e.$emit("request-close")}}})],1)],1)],1)],1)}),[],!1,null,null,null);"function"==typeof _&&_(y),y.options.__hasBlocks={script:!0,template:!0};t.default=y.exports},Y4vP:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Mention")},YVua:function(e,t,n){"use strict";n.r(t),n.d(t,"wrapInList",(function(){return o})),n.d(t,"splitListItem",(function(){return a})),n.d(t,"liftListItem",(function(){return s})),n.d(t,"sinkListItem",(function(){return u}));var i=n("CksW"),r=n("/7YT");function o(e,t){return function(n,o){var a=n.selection,s=a.$from,u=a.$to,c=s.blockRange(u),l=!1,d=c;if(!c)return!1;if(c.depth>=2&&s.node(c.depth-1).type.compatibleContent(e)&&0==c.startIndex){if(0==s.index(c.depth-1))return!1;var f=n.doc.resolve(c.start-2);d=new r.NodeRange(f,f,c.depth),c.endIndex<c.parent.childCount&&(c=new r.NodeRange(s,n.doc.resolve(u.end(c.depth)),c.depth)),l=!0}var p=Object(i.findWrapping)(d,e,t,c);return!!p&&(o&&o(function(e,t,n,o,a){for(var s=r.Fragment.empty,u=n.length-1;u>=0;u--)s=r.Fragment.from(n[u].type.create(n[u].attrs,s));e.step(new i.ReplaceAroundStep(t.start-(o?2:0),t.end,t.start,t.end,new r.Slice(s,0,0),n.length,!0));for(var c=0,l=0;l<n.length;l++)n[l].type==a&&(c=l+1);for(var d=n.length-c,f=t.start+n.length-(o?2:0),p=t.parent,m=t.startIndex,h=t.endIndex,v=!0;m<h;m++,v=!1)!v&&Object(i.canSplit)(e.doc,f,d)&&(e.split(f,d),f+=2*d),f+=p.child(m).nodeSize;return e}(n.tr,c,p,l,e).scrollIntoView()),!0)}}function a(e){return function(t,n){var o=t.selection,a=o.$from,s=o.$to,u=o.node;if(u&&u.isBlock||a.depth<2||!a.sameParent(s))return!1;var c=a.node(-1);if(c.type!=e)return!1;if(0==a.parent.content.size){if(2==a.depth||a.node(-3).type!=e||a.index(-2)!=a.node(-2).childCount-1)return!1;if(n){for(var l=r.Fragment.empty,d=a.index(-1)>0,f=a.depth-(d?1:2);f>=a.depth-3;f--)l=r.Fragment.from(a.node(f).copy(l));l=l.append(r.Fragment.from(e.createAndFill()));var p=t.tr.replace(a.before(d?null:-1),a.after(-3),new r.Slice(l,d?3:2,2));p.setSelection(t.selection.constructor.near(p.doc.resolve(a.pos+(d?3:2)))),n(p.scrollIntoView())}return!0}var m=s.pos==a.end()?c.contentMatchAt(0).defaultType:null,h=t.tr.delete(a.pos,s.pos),v=m&&[null,{type:m}];return!!Object(i.canSplit)(h.doc,a.pos,2,v)&&(n&&n(h.split(a.pos,2,v).scrollIntoView()),!0)}}function s(e){return function(t,n){var o=t.selection,a=o.$from,s=o.$to,u=a.blockRange(s,(function(t){return t.childCount&&t.firstChild.type==e}));return!!u&&(!n||(a.node(u.depth-1).type==e?function(e,t,n,o){var a=e.tr,s=o.end,u=o.$to.end(o.depth);s<u&&(a.step(new i.ReplaceAroundStep(s-1,u,s,u,new r.Slice(r.Fragment.from(n.create(null,o.parent.copy())),1,0),1,!0)),o=new r.NodeRange(a.doc.resolve(o.$from.pos),a.doc.resolve(u),o.depth));return t(a.lift(o,Object(i.liftTarget)(o)).scrollIntoView()),!0}(t,n,e,u):function(e,t,n){for(var o=e.tr,a=n.parent,s=n.end,u=n.endIndex-1,c=n.startIndex;u>c;u--)s-=a.child(u).nodeSize,o.delete(s-1,s+1);var l=o.doc.resolve(n.start),d=l.nodeAfter,f=0==n.startIndex,p=n.endIndex==a.childCount,m=l.node(-1),h=l.index(-1);if(!m.canReplace(h+(f?0:1),h+1,d.content.append(p?r.Fragment.empty:r.Fragment.from(a))))return!1;var v=l.pos,k=v+d.nodeSize;return o.step(new i.ReplaceAroundStep(v-(f?1:0),k+(p?1:0),v+1,k-1,new r.Slice((f?r.Fragment.empty:r.Fragment.from(a.copy(r.Fragment.empty))).append(p?r.Fragment.empty:r.Fragment.from(a.copy(r.Fragment.empty))),f?0:1,p?0:1),f?0:1)),t(o.scrollIntoView()),!0}(t,n,u)))}}function u(e){return function(t,n){var o=t.selection,a=o.$from,s=o.$to,u=a.blockRange(s,(function(t){return t.childCount&&t.firstChild.type==e}));if(!u)return!1;var c=u.startIndex;if(0==c)return!1;var l=u.parent,d=l.child(c-1);if(d.type!=e)return!1;if(n){var f=d.lastChild&&d.lastChild.type==l.type,p=r.Fragment.from(f?e.create():null),m=new r.Slice(r.Fragment.from(e.create(null,r.Fragment.from(l.type.create(null,p)))),f?3:1,0),h=u.start,v=u.end;n(t.tr.step(new i.ReplaceAroundStep(h-(f?3:1),v,h,v,m,1,!0)).scrollIntoView())}return!0}}},Z5hI:function(e,t){e.exports=tui.require("tui/components/icons/HorizontalRule")},ZhPi:function(e,t,n){var i=n("WkPL");e.exports=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}},a1gu:function(e,t,n){var i=n("cDf5"),r=n("PJYZ");e.exports=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?r(e):t}},"aBJ+":function(e,t){e.exports=tui.require("tui/geometry")},aLSn:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("zJMb"),m=n("cy56"),h=n("V68o"),v=n("O5Oz"),k=n.n(v),g=n("fRht"),_=n.n(g),y=n("zyVY"),b=n.n(y),x=n("i7/w"),w=n.n(x),N=n("7osU"),O=n("b7+R");function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var I=function(e){u()(n,e);var t=S(n);function n(e){var i;r()(this,n),i=t.call(this,e),void 0===e&&(e={}),i.emojis=e.emojis||[];var o=i.emojis.map((function(e){return e.pattern}));return i.charArray=o.toString().split(""),i.charArray=i.charArray.filter((function(e,t){return i.charArray.indexOf(e)===t})),i}return a()(n,[{key:"nodes",value:function(){return{emoji:{schema:{group:"inline",inline:!0,attrs:{shortcode:{default:""}},parseDOM:[{tag:"span.tui-wekaNodeEmoji",getAttrs:O.getJsonAttrs}],toDOM:function(e){return["span",{class:"tui-wekaNodeEmoji","data-attrs":JSON.stringify({shortcode:e.attrs.shortcode})},String.fromCodePoint("0x"+e.attrs.shortcode)]}},component:_.a}}}},{key:"plugins",value:function(){return[Object(N.default)(this.editor,this.emojis,this.charArray)]}},{key:"toolbarItems",value:function(){return[new m.ToolbarItem({group:"embeds",popover:{title:"",component:this.getEmojiPopover()},label:Object(h.langString)("insertemoji","editor"),iconComponent:b.a,enabled:function(e){return e.view.state.selection.$head.pos>0},reset:function(e){e.view.focus()}})]}},{key:"getEmojiPopover",value:function(){var e=this;return w.a.extend({data:function(){return{insertEmoji:e.insertEmoji.bind(e),emojiData:e.emojis}},methods:{emojiSelected:function(e){this.$emit("close"),this.insertEmoji(e)}},render:function(e){return e(k.a,{props:{emojis:this.emojiData},on:{"emoji-selected":this.emojiSelected}})}})}},{key:"insertEmoji",value:function(e){var t=this,n=e.shortcode;this.editor.execute((function(e,i){var r=e.schema.node("emoji",{shortcode:n}),o=e.selection,a=o.from,s=o.to;i(e.tr.replaceWith(a,s,r)),t.editor.view.focus()}))}}]),n}(p.default);t.default=function(e){return new I(e)}},aaOI:function(e,t,n){"use strict";n.r(t),t.default={props:{filename:{type:String,required:!0},fileSize:{type:[String,Number],required:!0},draftId:{type:[String,Number],required:!0},hasDownloadUrl:Boolean}}},av8V:function(e,t,n){"use strict";n.r(t);var i=n("00Pk"),r=n.n(i),o=n("tnXT"),a=n.n(o),s=n("hg2Q"),u=n("r4xq"),c=n.n(u),l={components:{CoreAudioBlock:r.a,NodeBar:c.a},extends:a.a,apollo:{file:{query:s.a,variables:function(){return{item_id:this.itemId,filename:this.filename}}}},data:function(){return{file:{}}},computed:{actions:function(){var e=this,t=[];return this.hasAttachmentNode&&t.push({label:this.$str("display_as_attachment","editor_weka"),action:function(){e.$_toAttachment()}}),t=t.concat([{label:this.$str("remove","core"),action:function(){e.$_removeNode()}}]),this.downloadUrl&&t.push({label:this.$str("download","core"),action:function(){window.document.location.href=e.downloadUrl}}),t},itemId:function(){if(!this.context.getItemId)throw new Error('No function "getItemId" found for extension media');return this.context.getItemId()},filename:function(){return this.attrs.filename?this.attrs.filename:null},hasAttachmentNode:function(){return!!this.context.hasAttachmentNode&&this.context.hasAttachmentNode()},downloadUrl:function(){return this.context.getFileUrl?this.context.getFileUrl(this.filename):null}},methods:{$_removeNode:function(){if(this.context.removeNode)return this.context.removeNode(this.getRange)},$_toAttachment:function(){if(this.context.replaceWithAttachment){var e={filename:this.filename,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)}}}},d=(n("S8i7"),n("KHd+")),f=function(e){e.options.__langStrings={core:["remove","download"],editor_weka:["display_as_attachment","actions_menu_for"]}},p=Object(d.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaAudioBlock"},[e.$apollo.loading?e._e():[n("div",{staticClass:"tui-wekaAudioBlock__inner"},[n("CoreAudioBlock",{attrs:{filename:e.filename,"item-id":e.itemId,url:e.file.url,"mime-type":e.file.mime_type}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)]],2)}),[],!1,null,null,null);"function"==typeof f&&f(p),p.options.__hasBlocks={script:!0,template:!0};t.default=p.exports},b48C:function(e,t){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}},"b7+R":function(e,t,n){"use strict";function i(e){try{return JSON.parse(e.getAttribute("data-attrs"))}catch(e){return{}}}function r(e){return function(t){var n={};return e.forEach((function(e){var i=t.getAttribute(e);n[e]=null==i?void 0:i})),n}}n.r(t),n.d(t,"getJsonAttrs",(function(){return i})),n.d(t,"attrGetter",(function(){return r}))},bJQT:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/AttachmentNodeCollection")},bo3x:function(e,t,n){"use strict";n.r(t);var i=n("ce8f"),r=n.n(i),o=n("5h9J"),a=n.n(o),s=n("sxi1"),u=n.n(s),c={components:{ActionDropdown:r.a,ButtonIcon:a.a,More:u.a},props:{actions:{type:Array,required:!0},ariaLabel:String}},l=(n("X5W2"),n("KHd+")),d=function(e){e.options.__langStrings={editor_weka:["more_items"]}},f=Object(l.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaNodeBar"},[n("ActionDropdown",{attrs:{position:"bottom-right",actions:e.actions},scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,r=t.isOpen;return[n("ButtonIcon",{attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":r?"true":"false","aria-label":e.ariaLabel?e.ariaLabel:e.$str("more_items","editor_weka"),"data-weka-more":!0},on:{click:i}},[n("More")],1)]}}])})],1)}),[],!1,null,null,null);"function"==typeof d&&d(f),f.options.__hasBlocks={script:!0,template:!0};t.default=f.exports},cDf5:function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},ce8f:function(e,t){e.exports=tui.require("editor_weka/components/editing/ActionDropdown")},cy56:function(e,t,n){"use strict";n.r(t),n.d(t,"ToolbarItem",(function(){return u})),n.d(t,"cmdItem",(function(){return c})),n.d(t,"markItem",(function(){return l})),n.d(t,"blockTypeItem",(function(){return d}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("zTcH"),u=function(){function e(t){var n=this;r()(this,e),this._opts=t,this._editor=null,this._def={group:t.group,label:t.label,iconComponent:t.iconComponent,enabled:!0,active:null,children:t.children&&t.children.map((function(e){return e.getDef()})),popover:t.popover,execute:function(){return t.execute(n._editor)},reset:function(){return t.reset(n._editor)}}}return a()(e,[{key:"update",value:function(e){var t=this._def,n=this._opts;return this._editor=e,t.enabled=void 0===n.enabled||n.enabled(e),t.active=null!=n.active?n.active(e):null,n.children&&n.children.forEach((function(t){return t.update(e)})),Object.assign({},t)}},{key:"getDef",value:function(){return this._def}}]),e}();function c(e,t){return new u(Object.assign({enabled:function(t){return t.canExecute(e)},execute:function(t){t.view.focus(),t.execute(e)}},t))}function l(e,t){return t=Object.assign({active:function(t){return n=t.state,i=e,r=n.selection,o=r.from,a=r.$from,s=r.to,r.empty?!!i.isInSet(n.storedMarks||a.marks()):!!n.doc.rangeHasMark(o,s,i);var n,i,r,o,a,s}},t),c(Object(s.toggleMark)(e),t)}function d(e,t,n){return n=Object.assign({active:function(n){var i=n.state.selection,r=i.$from,o=i.to,a=i.node;return a&&a.isTextblock?a.hasMarkup(e,t.attrs):o<=r.end()&&r.parent.hasMarkup(e,t.attrs)}},n),c(Object(s.setBlockType)(e,t.attrs),n)}},"d+14":function(e,t,n){"use strict";n.r(t);var i=n("RNtj"),r=n.n(i),o=n("r4xq"),a=n.n(o),s=n("zK61"),u=n.n(s),c={components:{NodeBar:a.a,AttachmentNode:r.a},mixins:[u.a],props:{enableConvert:{type:Boolean,default:!0}},computed:{actions:function(){var e=this,t=[];return this.enableConvert&&t.push({label:this.$str("display_as_embedded_media","editor_weka"),action:function(){e.$emit("convert-to-embedded-media")}}),t=t.concat([{label:this.$str("remove","core"),action:function(){e.$emit("delete")}}]),this.hasDownloadUrl&&t.push({label:this.$str("download","core"),action:function(){e.$emit("download")}}),t}}},l=n("KHd+"),d=function(e){e.options.__langStrings={editor_weka:["display_as_embedded_media","actions_menu_for"],core:["remove","download"]}},f=Object(l.a)(c,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)}),[],!1,null,null,null);"function"==typeof d&&d(f),f.options.__hasBlocks={script:!0,template:!0};t.default=f.exports},dRRP:function(e,t,n){"use strict";n.r(t);var i=n("RNtj"),r=n.n(i),o=n("r4xq"),a=n.n(o),s=n("zK61"),u=n.n(s),c={components:{AttachmentNode:r.a,NodeBar:a.a},mixins:[u.a],props:{enableConvert:{type:Boolean,default:!0}},computed:{actions:function(){var e=this,t=[];return this.enableConvert&&t.push({label:this.$str("display_as_embedded_media","editor_weka"),action:function(){e.$emit("convert-to-embedded-media")}}),t=t.concat([{label:this.$str("remove","core"),action:function(){e.$emit("delete")}}]),this.hasDownloadUrl&&t.push({label:this.$str("download","core"),action:function(){e.$emit("download")}}),t}}},l=n("KHd+"),d=function(e){e.options.__langStrings={core:["remove","download"],editor_weka:["display_as_embedded_media","actions_menu_for"]}},f=Object(l.a)(c,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,"item-id":this.draftId,component:"user",area:"draft"}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)}),[],!1,null,null,null);"function"==typeof d&&d(f),f.options.__hasBlocks={script:!0,template:!0};t.default=f.exports},daNz:function(e,t){e.exports=tui.require("ext_prosemirror/keymap")},dleW:function(e,t,n){"use strict";n.r(t);var i=n("TXEh"),r=n("GcJT"),o=n("TnOg"),a=n("+pLW"),s=n.n(a);t.default=function(e){var t=new r.PluginKey("mentions"),n=new o.default(e),a=new RegExp("@[^@\\s]+","g");return new r.Plugin({key:t,view:function(){var e=this;return{update:Object(i.debounce)((function(t){var i=e.key.getState(t.state),r=i.text,o=i.active,a=i.range;n.destroyInstance(),r&&o&&n.showList({view:t,component:{name:"mention",component:s.a,attrs:function(e,t){return{id:e,display:t}}},state:{text:r.slice(1),active:o,range:a}})}),250)}},state:{init:function(){return{active:!1,range:{},text:null}},apply:function(e,t){return n.apply(e,t,a)}},props:{handleKeyDown:function(e,t){if("Escape"===t.key)return!!this.getState(e.state).active&&(n.destroyInstance(),e.focus(),!0)}}})}},dxp4:function(e,t,n){var i={"./ComponentView":"vFxO","./ComponentView.js":"vFxO","./Editor":"5vO2","./Editor.js":"5vO2","./WekaValue":"w52A","./WekaValue.js":"w52A","./api":"G709","./api.js":"G709","./extensions/Base":"zJMb","./extensions/Base.js":"zJMb","./extensions/attachment":"w4Gt","./extensions/attachment.js":"w4Gt","./extensions/emoji":"aLSn","./extensions/emoji.js":"aLSn","./extensions/hashtag":"hRV1","./extensions/hashtag.js":"hRV1","./extensions/link":"gCcX","./extensions/link.js":"gCcX","./extensions/list":"UwCb","./extensions/list.js":"UwCb","./extensions/media":"LqeG","./extensions/media.js":"LqeG","./extensions/mention":"CvRQ","./extensions/mention.js":"CvRQ","./extensions/ruler":"zPke","./extensions/ruler.js":"zPke","./extensions/text":"B6jB","./extensions/text.js":"B6jB","./extensions/util":"b7+R","./extensions/util.js":"b7+R","./helpers/editor":"kS2v","./helpers/editor.js":"kS2v","./helpers/file":"7gPm","./helpers/file.js":"7gPm","./helpers/media":"P4HX","./helpers/media.js":"P4HX","./helpers/mention":"nyAV","./helpers/mention.js":"nyAV","./helpers/suggestion":"TnOg","./helpers/suggestion.js":"TnOg","./integration":"jknM","./integration.js":"jknM","./keymap":"SeWd","./keymap.js":"SeWd","./lib/prosemirror_schema_list/schema_list":"YVua","./lib/prosemirror_schema_list/schema_list.js":"YVua","./lib/prosemirror_utils/helpers":"Ko4C","./lib/prosemirror_utils/helpers.js":"Ko4C","./lib/prosemirror_utils/selection":"D7iR","./lib/prosemirror_utils/selection.js":"D7iR","./lib/prosemirror_utils/transforms":"VR8M","./lib/prosemirror_utils/transforms.js":"VR8M","./mixins/attachment_mixin":"aaOI","./mixins/attachment_mixin.js":"aaOI","./plugins/attachment":"LAEe","./plugins/attachment.js":"LAEe","./plugins/emoji":"7osU","./plugins/emoji.js":"7osU","./plugins/hashtag":"4uRO","./plugins/hashtag.js":"4uRO","./plugins/mention":"dleW","./plugins/mention.js":"dleW","./plugins/text_placeholder":"7F6Z","./plugins/text_placeholder.js":"7F6Z","./schema":"mi/L","./schema.js":"mi/L","./toolbar":"cy56","./toolbar.js":"cy56","./transaction":"U9km","./transaction.js":"U9km","./util":"1egj","./util.js":"1egj","./utils/list":"/uQ1","./utils/list.js":"/uQ1","./utils/upload":"KY8K","./utils/upload.js":"KY8K"};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id="dxp4"},fNlv:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),r=n.n(i),o=n("mD75"),a={components:{Hashtag:n.n(o).a},extends:r.a,computed:{text:function(){return this.attrs.text},url:function(){return this.$url("/totara/catalog/index.php",{catalog_fts:this.attrs.text})}}},s=n("KHd+"),u=function(e){e.options.__langStrings={editor_weka:["hashtag"]}},c=Object(s.a)(a,(function(){var e=this.$createElement;return(this._self._c||e)("Hashtag",{attrs:{url:this.url,text:this.$str("hashtag","editor_weka",this.text)},nativeOn:{click:function(e){e.preventDefault()}}})}),[],!1,null,null,null);"function"==typeof u&&u(c),c.options.__hasBlocks={script:!0,template:!0};t.default=c.exports},fRht:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Emoji")},gCcX:function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("PJYZ"),f=n.n(d),p=n("7W2i"),m=n.n(p),h=n("a1gu"),v=n.n(h),k=n("Nsbk"),g=n.n(k),_=n("zJMb"),y=n("b7+R"),b=n("Nfo2"),x=n.n(b),w=n("9cw/"),N=n.n(w),O=n("9Wm2"),S=n.n(O),I=n("OxlY"),j=n.n(I),T=n("k+sG"),A=n.n(T),E=n("GcJT"),$=n("/7YT"),M=n("V68o"),D=n("cy56"),C=n("G709"),R=n("U9km"),B=n("1egj"),F=n("TXEh"),P=n("vyVp");function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=g()(e);if(t){var r=g()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return v()(this,n)}}var V=/\bhttps?:\/\/[-a-zA-Z0-9@:%._+~#=]+\b(?:[-a-zA-Z0-9@:%_+.~#?&//=]*)/g,q=["link_block","link_media"],W=function(e){m()(o,e);var t,n,i=L(o);function o(e){var t;return u()(this,o),(t=i.call(this,e)).isMedia=t.isMedia.bind(f()(t)),t._convertPastedUrl=t._convertPastedUrl.bind(f()(t)),t._getSelectionRange=t._getSelectionRange.bind(f()(t)),t}return l()(o,[{key:"nodes",value:function(){return{link_media:{schema:{group:"block",atom:!0,attrs:{url:{},loading:{default:void 0},type:{default:void 0},image:{default:void 0},title:{default:void 0},description:{default:void 0},siteName:{default:void 0},resolution:{default:void 0}},parseDOM:[{tag:".tui-wekaNodeLinkMedia",getAttrs:y.getJsonAttrs}],toDOM:function(e){return["a",{class:"tui-wekaNodeLinkMedia","data-attrs":JSON.stringify(e.attrs),href:e.attrs.url},e.attrs.url]}},component:N.a,componentContext:{urlPlugin:this.urlPlugin.bind(this),editCard:this.editCard.bind(this),replaceWithTextLink:this.replaceWithTextLink.bind(this)}},link_block:{schema:{group:"block",atom:!0,attrs:{url:{},type:{default:void 0},image:{default:void 0},title:{default:void 0},description:{default:void 0},siteName:{default:void 0}},parseDOM:[{tag:".tui-wekaNodeLinkBlock",getAttrs:y.getJsonAttrs}],toDOM:function(e){return["a",{class:"tui-wekaNodeLinkBlock","data-attrs":JSON.stringify(e.attrs),href:e.attrs.url},e.attrs.url]}},component:x.a,componentContext:{editCard:this.editCard.bind(this),replaceWithTextLink:this.replaceWithTextLink.bind(this)}}}}},{key:"marks",value:function(){return{link:{schema:{attrs:{href:{},title:{default:void 0}},inclusive:!1,parseDOM:[{tag:"a[href]:not([class*=tui-weka])",getAttrs:Object(y.attrGetter)(["href","title"])}],toDOM:function(e){var t=e.attrs;return["a",{href:t.href,title:t.title},0]}},component:S.a,componentContext:{showMarkDropdown:this.showMarkDropdown.bind(this)}}}}},{key:"plugins",value:function(){var e=this;return[new E.Plugin({props:{transformPasted:function(t){return new $.Slice(function e(t,n){var i=[];return t.forEach((function(t){if(t.isText){var r,o=t.text,a=0;for(V.lastIndex=0;r=V.exec(o);){var s=r.index,u=s+r[0].length;s>0&&i.push(t.cut(a,s));var c=o.slice(s,u),l=n.convert(c);l instanceof $.Node?i.push(l):l instanceof $.Mark?i.push(t.cut(s,u).mark(l.addToSet(t.marks))):i.push(t.cut(s,u)),a=u}a<o.length&&i.push(t.cut(a))}else i.push(t.copy(e(t.content,n)))})),$.Fragment.fromArray(i)}(t.content,{convert:e._convertPastedUrl}),t.openStart,t.openEnd)}}})]}},{key:"toolbarItems",value:function(){var e=this;return[new D.ToolbarItem({group:"embeds",label:Object(M.langString)("link","editor_weka"),iconComponent:A.a,execute:function(){e.editLink()}})]}},{key:"editLink",value:function(){var e=this,t=this.getSchema().marks.link,n=this._getSelectionRange();if(n.from===n.to){var i=Object(B.getMarkRange)(this.doc.resolve(n.from),t);if(i)return void this._editMarkAt((function(){return i}))}var o,s=this.doc.textBetween(n.from,n.to);this.showModal(j.a,{isNew:!0,isMedia:this.isMedia,attrs:{url:"",text:s},save:(o=a()(r.a.mark((function t(n){var i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._prepareLinkUpdate(n);case 2:i=t.sent,e._updateLink({type:null,getRange:e._getSelectionRange},i),e.editor.view.focus();case 5:case"end":return t.stop()}}),t)}))),function(e){return o.apply(this,arguments)})})}},{key:"replaceWithTextLink",value:function(e,t){var n=t.url;this.editor.execute((function(t,i){var r=t.schema.text(n,[t.schema.mark("link",{href:n})]),o=e();i(t.tr.replaceWith(o.from,o.to,r))}))}},{key:"urlPlugin",value:function(e){return this._findLinkPlugin(e)}},{key:"isMedia",value:function(e){return!!this._findLinkPlugin({type:"media",url:e})}},{key:"editCard",value:function(e){var t,n=this,i=this.doc.nodeAt(e().from),o=i.type.name;q.includes(o)&&this.showModal(j.a,{isMedia:this.isMedia,attrs:{type:o,url:i.attrs.url},save:(t=a()(r.a.mark((function t(i){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._prepareLinkUpdate(i);case 2:a=t.sent,n._updateLink({type:o,getRange:e},a),n.editor.view.focus();case 5:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})})}},{key:"showMarkDropdown",value:function(e){var t=this,n=this._getLinkMark(e);if(n){var i=n&&this.isMedia(n.attrs.href);return this.showActionDropdown(e().from,{actions:[{label:Object(M.langString)("go_to_link","editor_weka"),action:function(){return t._openLinkMarkAt(e)}},{label:Object(M.langString)("edit","core"),action:function(){return t._editMarkAt(e)}},{label:i?Object(M.langString)("display_as_embedded_media","editor_weka"):Object(M.langString)("display_as_card","editor_weka"),action:function(){return t._markToCardAt(i?"link_media":"link_block",e)}},{label:Object(M.langString)("remove","core"),action:function(){return t._removeMarkAt(e)}}]})}}},{key:"_findLinkPlugin",value:function(e){for(var t=e.type,n=e.url,i=0;i<U.length;i++){var r=U[i];if(!t||r.type===t)for(var o=0;o<r.matches.length;o++){var a=r.matches[o],s=a.match.exec(n);if(s)return{plugin:r,details:a.details?a.details(s):{}}}}return null}},{key:"_updateLink",value:function(e,t){var n=this;e||(e={type:null,getRange:this._getSelectionRange});var i=null;if("link"===e.type||null===e.type){var r=e.getRange();i=this.doc.textBetween(r.from,r.to)}this.editor.execute((function(r,o){var a=Object(B.expandContentResolvedRange)(B.ResolvedRange.resolve(n.doc,e.getRange()));if("link"==t.type){var s=r.schema.marks.link,u=t.text||t.url,c=s.create({href:t.url});o("link"==e.type&&i&&u===i?r.tr.removeMark(a.$from.pos,a.$to.pos,s).addMark(a.$from.pos,a.$to.pos,c):r.tr.replaceWith(a.$from.pos,a.$to.pos,u?r.schema.text(u,[c]):$.Fragment.empty))}else q.includes(t.type)&&o(r.tr.replaceWith(a.$from.pos,a.$to.pos,t.content))}))}},{key:"_prepareLinkUpdate",value:(n=a()(r.a.mark((function e(t){var n,i,o,a,s,u,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.type,i=t.url,o=t.text,!q.includes(n)){e.next=33;break}if(a=this.editor.state.schema,!(s=(!n||"link_media"==n)&&this._findLinkPlugin({type:"media",url:i}))){e.next=19;break}if(!s.plugin.nodeAttrs){e.next=16;break}return e.prev=6,e.next=9,s.plugin.nodeAttrs({url:i});case 9:u=e.sent,e.next=16;break;case 12:e.prev=12,e.t0=e.catch(6),u={},console.error(e.t0);case 16:return e.abrupt("return",new z({type:n,url:i,content:a.node("link_media",Object.assign({url:i},u))}));case 19:return e.prev=19,e.next=22,Object(C.getLinkMetadata)(i);case 22:l=e.sent,c=H(l),e.next=30;break;case 26:e.prev=26,e.t1=e.catch(19),console.error(e.t1),c={};case 30:return e.abrupt("return",new z({type:n,url:i,content:a.node("link_block",Object.assign({url:i},c))}));case 31:e.next=34;break;case 33:return e.abrupt("return",new z({type:"link",url:i,text:o}));case 34:case"end":return e.stop()}}),e,this,[[6,12],[19,26]])}))),function(e){return n.apply(this,arguments)})},{key:"_convertPastedUrl",value:function(e){var t=this,n=this.getSchema().marks.link,i=this.getSchema().nodes.link_media,r=this._findLinkPlugin({type:"media",url:e});if(r){var o={url:e};r.plugin.nodeAttrs&&(o.loading=!0);var a=i.create(o);return o.loading&&r.plugin.nodeAttrs({url:e}).then((function(n){t._updatePastedMedia(e,n)})).catch((function(n){console.error(n),t._updatePastedMedia(e,{})})),a}return n.create({href:e})}},{key:"_updatePastedMedia",value:function(e,t){var n=this.getSchema().nodes.link_media,i=this.editor.state.tr;this.editor.state.doc.descendants((function(r,o){if(r.type==n&&r.attrs.loading&&r.attrs.url===e){var a=Object.assign({},r.attrs,{loading:!1},t);i=Object(R.setAttrs)(o,a)(i)}})),i.setMeta("addToHistory",!1),this.editor.dispatch(i)}},{key:"_getSelectionRange",value:function(){return Object(F.pick)(this.editor.state.selection,["from","to"])}},{key:"_getLinkMark",value:function(e){return Object(B.getMark)(this.doc.resolve(e().from),this.getSchema().marks.link)}},{key:"_openLinkMarkAt",value:function(e){var t=this._getLinkMark(e);t&&window.open(t.attrs.href)}},{key:"_editMarkAt",value:function(e){var t=this,n=e(),i=this._getLinkMark(e);if(i){var o,s=i.attrs.href,u=this.doc.textBetween(n.from,n.to);s===u&&(u=null),this.showModal(j.a,{isMedia:this.isMedia,attrs:{url:s,text:u},save:(o=a()(r.a.mark((function n(i){var o;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._prepareLinkUpdate(i);case 2:o=n.sent,t._updateLink({type:"link",getRange:e},o),t.editor.view.focus();case 5:case"end":return n.stop()}}),n)}))),function(e){return o.apply(this,arguments)})})}}},{key:"_markToCardAt",value:(t=a()(r.a.mark((function e(t,n){var i,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._getLinkMark(n)){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._prepareLinkUpdate({type:t,url:i.attrs.href});case 6:o=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),G(e.t0),e.abrupt("return");case 13:this._updateLink({type:"link",getRange:n},o),this.editor.view.focus();case 15:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,n){return t.apply(this,arguments)})},{key:"_removeMarkAt",value:function(e){var t=this;this.editor.execute((function(n,i){var r=Object(B.expandContentResolvedRange)(B.ResolvedRange.resolve(t.doc,e()));i(n.tr.delete(r.$from.pos,r.$to.pos))})),this.editor.view.focus()}}]),o}(_.default),z=function e(t){u()(this,e),Object.assign(this,t)},U=[{key:"youtube",type:"media",name:"YouTube",matches:[{match:/^https?:\/\/(?:www\.)?youtube.com\/watch\?v=([a-zA-Z0-9_-]+)/,details:function(e){return{id:e[1]}}},{match:/^https?:\/\/(?:www\.)?youtu.be\/([a-zA-Z0-9_-]+)/,details:function(e){return{id:e[1]}}}],nodeAttrs:function(e){var t=e.url;return a()(r.a.mark((function e(){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(C.getLinkMetadata)(t);case 2:return n=e.sent,e.abrupt("return",K(n));case 4:case"end":return e.stop()}}),e)})))()}},{key:"vimeo",type:"media",name:"Vimeo",matches:[{match:/^https?:\/\/(?:www\.)?vimeo.com\/([0-9]+)/,details:function(e){return{id:e[1]}}}],nodeAttrs:function(e){var t=e.url;return a()(r.a.mark((function e(){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(C.getLinkMetadata)(t);case 2:return n=e.sent,e.abrupt("return",K(n));case 4:case"end":return e.stop()}}),e)})))()}},{key:"image",type:"media",name:"Image",matches:[{match:/\.(png|jpe?g|gif|webp|avif)$/}]},{key:"audio",type:"media",name:"Audio",matches:[{match:/\.(aac|flac|m4a|mp3|ogg|opus|wav|wma)$/}]}];var J=function(e){var t={};for(var n in e)null!=e[n]&&(t[n]=e[n]);return t};function K(e){if(null===e)return null;var t=J(Object(F.pick)(e,["url","image","title","description"])),n=Number(e.videowidth),i=Number(e.videoheight);return t.resolution=isNaN(n)||isNaN(i)?void 0:{width:n,height:i},t}function H(e){return null===e?null:J(Object(F.pick)(e,["url","image","title","description"]))}function G(){return X.apply(this,arguments)}function X(){return(X=a()(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(M.langString)("error_no_url_info","editor_weka"),e.next=3,Object(M.loadLangStrings)([t]);case 3:Object(P.notify)({type:"error",message:t.toString()});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.default=function(e){return new W(e)}},gLvT:function(e,t){e.exports=tui.require("tui/components/dropdown/Dropdown")},gTrn:function(e,t){},gfQI:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),r=n.n(i),o=n("r4xq"),a=n.n(o),s=n("3bgQ"),u=n.n(s),c=n("IBd2"),l=n.n(c),d={components:{NodeBar:a.a,ResponsiveEmbedIframe:u.a,ResponsiveImage:l.a},extends:r.a,computed:{pluginMatch:function(){return this.context.urlPlugin({type:"media",url:this.attrs.url})||{}},pluginKey:function(){return this.pluginMatch.plugin&&this.pluginMatch.plugin.key},pluginName:function(){return this.pluginMatch.plugin&&this.pluginMatch.plugin.name},details:function(){return this.pluginMatch.details||{}},actions:function(){var e=this;return[{label:this.$str("go_to_link","editor_weka"),action:function(){return e.open()}},{label:this.$str("edit","core"),action:function(){return e.edit()}},{label:this.$str("display_as_text","editor_weka"),action:function(){return e.toLink()}},{label:this.$str("remove","core"),action:function(){return e.$emit("remove")}}]},iframeUrl:function(){var e=this.details;switch(this.pluginKey){case"youtube":return"https://www.youtube.com/embed/"+e.id+"?rel=0";case"vimeo":return"https://player.vimeo.com/video/"+e.id+"?portrait=0"}return null},summaryText:function(){return this.pluginName+" - "+(this.attrs.title||this.attrs.url)}},methods:{open:function(){window.open(this.attrs.url)},edit:function(){this.context.editCard(this.getRange)},toLink:function(){var e=this.attrs.url;this.context.replaceWithTextLink(this.getRange,{url:e})}}},f=(n("4BOM"),n("KHd+")),p=function(e){e.options.__langStrings={core:["edit","remove"],editor_weka:["actions_menu_for","display_as_text","go_to_link"]}},m=Object(f.a)(d,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaLinkMedia",class:{"tui-wekaLinkMedia--intrinsic-width":!e.attrs.loading&&!e.iframeUrl},attrs:{"data-url":e.attrs.url}},[n("div",{staticClass:"tui-wekaLinkMedia__inner"},[e.attrs.loading?n("div",[e._v("\n      Loading...\n    ")]):e.iframeUrl?n("div",{staticClass:"tui-wekaLinkMedia__embed"},[n("ResponsiveEmbedIframe",{attrs:{src:e.iframeUrl,resolution:e.attrs.resolution,title:e.attrs.title||e.attrs.url}})],1):"audio"==e.pluginKey?n("div",[n("audio",{attrs:{controls:"",src:e.attrs.url}})]):"image"==e.pluginKey?n("div",[n("ResponsiveImage",{attrs:{src:e.attrs.url}})],1):n("div",[n("a",{attrs:{href:e.attrs.url}},[e._v(e._s(e.attrs.url))])]),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.summaryText)}})],1)])}),[],!1,null,null,null);"function"==typeof p&&p(m),m.options.__hasBlocks={script:!0,template:!0};t.default=m.exports},hFhO:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),r=n.n(i),o=n("5h9J"),a=n.n(o),s=n("gLvT"),u=n.n(s),c=n("3sQR"),l=n.n(c),d=n("0QOp"),f=n.n(d),p=n("sxi1"),m=n.n(p),h={components:{ButtonIcon:a.a,Dropdown:u.a,DropdownButton:l.a,LinkBlockInner:f.a,More:m.a},extends:r.a,methods:{open:function(){window.open(this.attrs.url)},edit:function(){this.context.editCard(this.getRange)},toLink:function(){var e=this.attrs.url;this.context.replaceWithTextLink(this.getRange,{url:e})},remove:function(){this.$emit("remove")}}},v=(n("7O4h"),n("KHd+")),k=function(e){e.options.__langStrings={core:["edit","remove"],editor_weka:["actions_menu_for","display_as_text","go_to_link"]}},g=Object(v.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaLinkBlock",attrs:{"data-url":e.attrs.url}},[n("Dropdown",{scopedSlots:e._u([{key:"trigger",fn:function(t){var i=t.toggle,r=t.isOpen;return[n("div",{on:{"!click":function(e){return e.preventDefault(),i(e)}}},[n("LinkBlockInner",{attrs:{attrs:e.attrs}})],1),e._v(" "),n("div",{staticClass:"tui-wekaLinkBlock__btn-wrapper"},[n("ButtonIcon",{staticClass:"tui-wekaLinkBlock__btn",attrs:{styleclass:{small:!0,transparent:!0},"aria-expanded":r.toString(),"aria-label":e.$str("actions_menu_for","editor_weka",e.attrs.title||e.attrs.url)},on:{click:i}},[n("More")],1)],1)]}}])},[e._v(" "),n("DropdownButton",{on:{click:e.open}},[e._v("\n      "+e._s(e.$str("go_to_link","editor_weka"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.edit}},[e._v("\n      "+e._s(e.$str("edit","core"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.toLink}},[e._v("\n      "+e._s(e.$str("display_as_text","editor_weka"))+"\n    ")]),e._v(" "),n("DropdownButton",{on:{click:e.remove}},[e._v("\n      "+e._s(e.$str("remove","core"))+"\n    ")])],1)],1)}),[],!1,null,null,null);"function"==typeof k&&k(g),g.options.__hasBlocks={script:!0,template:!0};t.default=g.exports},hRV1:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("zJMb"),m=n("4uRO"),h=n("nFyd"),v=n.n(h);function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var g=function(e){u()(n,e);var t=k(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{hashtag:{schema:{group:"inline",inline:!0,attrs:{text:{default:""}},parseDOM:[{tag:"span.tui-wekaNodeHashtag",getAttrs:function(e){try{return{text:e.textContent.trim().slice(1)}}catch(e){return{}}}}],toDOM:function(e){return["span",{class:"tui-wekaNodeHashtag"},"#"+e.attrs.text]}},component:v.a}}}},{key:"plugins",value:function(){return[Object(m.default)(this.editor)]}}]),n}(p.default);t.default=function(e){return new g(e)}},hg2Q:function(e,t,n){"use strict";t.a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"editor_weka_get_draft_file"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"item_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_integer"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"param_text"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"file"},name:{kind:"Name",value:"editor_weka_draft_file"},arguments:[{kind:"Argument",name:{kind:"Name",value:"item_id"},value:{kind:"Variable",name:{kind:"Name",value:"item_id"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mime_type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[{kind:"Argument",name:{kind:"Name",value:"force_download"},value:{kind:"BooleanValue",value:!0}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"media_type"},arguments:[],directives:[]}]}}]}}]}},"i/kK":function(e,t){e.exports=tui.require("tui/components/form/FormRow")},"i7/w":function(e,t){e.exports=tui.require("vue")},iFtU:function(e,t,n){"use strict";n.r(t);var i=n("RNtj"),r=n.n(i),o=n("r4xq"),a=n.n(o),s=n("zK61"),u=n.n(s),c={components:{AttachmentNode:r.a,NodeBar:a.a},mixins:[u.a],props:{enableConvert:{type:Boolean,default:!0}},data:function(){return{showModal:!1}},computed:{actions:function(){var e=this,t=[];return this.enableConvert&&t.push({label:this.$str("display_as_embedded_media","editor_weka"),action:function(){e.$emit("convert-to-embedded-media")}}),t=t.concat([{label:this.$str("remove","core"),action:function(){e.$emit("delete")}}]),this.hasDownloadUrl&&t.push({label:this.$str("download","core"),action:function(){e.$emit("download")}}),t}}},l=n("KHd+"),d=function(e){e.options.__langStrings={core:["download","remove"],editor_weka:["display_as_embedded_media","actions_menu_for"]}},f=Object(l.a)(c,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("AttachmentNode",{attrs:{filename:this.filename,"file-size":this.fileSize,component:"user",area:"draft","item-id":this.draftId}}),this._v(" "),t("NodeBar",{attrs:{actions:this.actions,"aria-label":this.$str("actions_menu_for","editor_weka",this.filename)}})],1)}),[],!1,null,null,null);"function"==typeof d&&d(f),f.options.__hasBlocks={script:!0,template:!0};t.default=f.exports},iPZg:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/ImageBlock")},ixxs:function(e,t){e.exports=tui.require("tui/components/icons/Show")},j1CR:function(e,t,n){var i={"./WekaIntegration":"oy78","./WekaIntegration.vue":"oy78","./fixtures/WekaBasic":"CLKc","./fixtures/WekaBasic.vue":"CLKc","./fixtures/WekaWithLearn":"7fvA","./fixtures/WekaWithLearn.vue":"7fvA"};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id="j1CR"},j1Jf:function(e,t,n){"use strict";n.r(t);var i=n("i7/w"),r=n.n(i),o=n("nEm4"),a=n.n(o),s=n("i/kK"),u=n.n(s),c=n("oMuj"),l=n.n(c),d=n("tkAW"),f=n.n(d),p=n("u5iS"),m=n.n(p),h=n("vF5l"),v=n.n(h),k=n("nXMa"),g=n.n(k),_=n("BN8m"),y=n.n(_),b={components:{Form:a.a,FormRow:u.a,InputText:l.a,Modal:f.a,ModalContent:m.a,Button:v.a,ButtonCancel:g.a,ButtonGroup:y.a},props:{isNew:Boolean,attrs:Object,save:Function,isMedia:Function},data:function(){return{url:this.attrs.url,text:this.attrs.text,loading:!1,display:this.attrs.type||"link",wasText:!!this.attrs.text,error:null}},computed:{urlIsMedia:function(){return this.isMedia&&this.isMedia(this.url)},formValue:function(){return{type:this.display,url:this.url,text:this.text}},formValid:function(){return!!this.url}},watch:{urlIsMedia:function(e){this.wasText||(this.display=e?"link_media":"link")},formValue:function(){this.error=null}},mounted:function(){var e=this;r.a.nextTick((function(){e.$refs.url&&e.$refs.url.$el&&e.$refs.url.$el.focus()}))},methods:{close:function(){this.$emit("request-close")},confirm:function(){var e=this;if(!this.loading){this.loading=!0;var t=this.formValue;Promise.resolve(this.save(t)).then(this.close).catch((function(e){console.error(e)})).then((function(){return e.loading=!1}))}},updateText:function(e){this.text=e}}},x=n("KHd+"),w=function(e){e.options.__langStrings={core:["cancel","ok"],editor:["linkurl"],editor_weka:["done","displayas","display_text","edit_link","insert_link","error_no_url_info"]}},N=Object(x.a)(b,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{attrs:{size:"normal","aria-labelledby":e.$id("title")}},[n("ModalContent",{attrs:{title:e.isNew?e.$str("insert_link","editor_weka"):e.$str("edit_link","editor_weka"),"title-id":e.$id("title"),"close-button":!0},scopedSlots:e._u([{key:"buttons",fn:function(){return[n("ButtonGroup",[n("Button",{attrs:{styleclass:{primary:"true"},text:e.$str("done","editor_weka"),disabled:!e.formValid||e.loading},on:{click:e.confirm}}),e._v(" "),n("ButtonCancel",{on:{click:e.close}})],1)]},proxy:!0}])},[n("Form",{on:{submit:function(t){return t.preventDefault(),e.confirm(t)}}},[e.error?n("p",[e._v(e._s(e.error))]):e._e(),e._v(" "),n("FormRow",{attrs:{label:e.$str("linkurl","editor")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{ref:"url",attrs:{id:i,autofocus:!0},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})]}}])}),e._v(" "),n("FormRow",{attrs:{label:e.$str("display_text","editor_weka")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.id;return[n("InputText",{attrs:{id:i,value:"link"==e.display?e.text:"",disabled:"link"!=e.display},on:{input:e.updateText}})]}}])}),e._v(" "),n("input",{style:{display:"none"},attrs:{type:"submit"}})],1)],1)],1)}),[],!1,null,null,null);"function"==typeof w&&w(N),N.options.__hasBlocks={script:!0,template:!0};t.default=N.exports},jHsM:function(e,t){e.exports=tui.require("editor_weka/components/attachments/AudioAttachment")},jknM:function(e,t,n){"use strict";n.r(t),n.d(t,"setupTextarea",(function(){return p}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("H/tB"),u=n.n(s),c=n("TXEh"),l=n("2wx7"),d=n.n(l),f=n("w52A");function p(e){var t=e.id,n=e.extensions,i=e.showtoolbar,r=e.file_item_id,o=e.context_id,a=e.files,s=document.getElementById(t);if(!s){var u=new Error("Textarea not found");throw u.code="TEXTAREA_NOT_FOUND",u}new m(t,s,{extensions:n,showtoolbar:i,context_id:o,files:a,file_item_id:r})}var m=function(){function e(t,n,i){var o=this;r()(this,e),this.id=t,this.textareaEl=n,n.style.display="none",n.setAttribute("data-enhanced",!0),this.wrapper=document.createElement("div");var a=document.createElement("div");this.wrapper.appendChild(a),this.textareaEl.parentNode.insertBefore(this.wrapper,this.textareaEl.nextSibling);var s=this.getWekaValue();this.wekaValue=s;var l=function(){o.wekaValue&&(o.textareaEl.value=JSON.stringify(o.wekaValue.getDoc()),o.textareaEl.dispatchEvent(new Event("change",{bubbles:!0})))},f=Object(c.throttle)(l,250);u.a.mount(d.a,{props:{value:s,options:i,fileItemId:i.file_item_id?i.file_item_id:void 0},on:{input:function(e){o.wekaValue=e,f()},blur:l,ready:function(){o.wekaValue.hasHtml()&&l()}}},a)}return a()(e,[{key:"getWekaValue",value:function(){var e=this.textareaEl.value;if(e){if(!this.looksLikeJson(e))return f.default.fromHtml(e);try{var t=JSON.parse(e);return f.default.fromDoc(t)}catch(e){console.error("[editor_weka] Error parsing JSON"),console.error(e)}}return f.default.empty()}},{key:"looksLikeJson",value:function(e){return"{"===e.slice(0,1)&&"}"===e.slice(e.length-1)}}]),e}()},"k+sG":function(e,t){e.exports=tui.require("tui/components/icons/Link")},kS2v:function(e,t,n){"use strict";function i(){return{type:"doc",content:[{type:"paragraph"}]}}n.r(t),n.d(t,"getDefaultDocument",(function(){return i}))},kgTP:function(e,t){e.exports=tui.require("editor_weka/helpers/editor")},kkOl:function(e,t){e.exports=tui.require("editor_weka/WekaValue")},lH1I:function(e,t){},laAb:function(e,t){},lqaC:function(e,t){},ls82:function(e,t,n){var i=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function s(e,t,n,i){var r=t&&t.prototype instanceof l?t:l,o=Object.create(r.prototype),a=new x(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return N()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=_(a,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var c={};function l(){}function d(){}function f(){}var p={};p[r]=function(){return this};var m=Object.getPrototypeOf,h=m&&m(m(w([])));h&&h!==t&&n.call(h,r)&&(p=h);var v=f.prototype=l.prototype=Object.create(p);function k(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function g(e,t){var i;this._invoke=function(r,o){function a(){return new t((function(i,a){!function i(r,o,a,s){var c=u(e[r],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}(r,o,i,a)}))}return i=i?i.then(a,a):a()}}function _(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var i=u(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,c;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function w(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:N}}function N(){return{value:void 0,done:!0}}return d.prototype=v.constructor=f,f.constructor=d,f[a]=d.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},k(g.prototype),g.prototype[o]=function(){return this},e.AsyncIterator=g,e.async=function(t,n,i,r,o){void 0===o&&(o=Promise);var a=new g(s(t,n,i,r),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(v),v[a]="Generator",v[r]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=w,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),b(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;b(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:w(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=i}catch(e){Function("r","regeneratorRuntime = r")(i)}},lwsE:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},m0LI:function(e,t){e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}},mB48:function(e,t){e.exports=tui.require("tui/dom/position")},mD75:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Hashtag")},"mi/L":function(e,t,n){"use strict";n.r(t),n.d(t,"createSchema",(function(){return a}));var i=n("/7YT"),r=["p",0],o={doc:{content:"block+"},paragraph:{group:"block",content:"inline*",parseDOM:[{tag:"p"}],toDOM:function(){return r}},text:{group:"inline"}};function a(e){var t=e.nodes,n=e.marks;return new i.Schema({nodes:Object.assign({},o,t),marks:n||{}})}},nEm4:function(e,t){e.exports=tui.require("tui/components/form/Form")},nFyd:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Hashtag")},nXMa:function(e,t){e.exports=tui.require("tui/components/buttons/Cancel")},nhhl:function(e,t,n){"use strict";n.r(t);var i=n("bJQT"),r={components:{AttachmentNodeCollection:n.n(i).a}},o=(n("xSMd"),n("KHd+")),a=Object(o.a)(r,(function(){var e=this.$createElement,t=this._self._c||e;return t("AttachmentNodeCollection",{staticClass:"tui-wekaAttachments"},[t("div",{ref:"content",staticClass:"tui-wekaAttachments__content"})])}),[],!1,null,null,null);a.options.__hasBlocks={script:!0,template:!0};t.default=a.exports},nyAV:function(e,t,n){"use strict";n.r(t),n.d(t,"createMentionContent",(function(){return r}));var i=n("kgTP");function r(e){var t=e.fullname,n=e.userId,r=Object(i.getDefaultDocument)();return r.content[0]={type:"paragraph",content:[{type:"mention",attrs:{id:n,display:t}},{type:"text",text:" "}]},r}},o0o1:function(e,t,n){e.exports=n("ls82")},oMuj:function(e,t){e.exports=tui.require("tui/components/form/InputText")},oShl:function(e,t,n){var i=n("Nsbk"),r=n("SksO"),o=n("xfeJ"),a=n("sXyB");function s(t){var n="function"==typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,i(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r(t,e)},s(t)}e.exports=s},oWLq:function(e,t){},oy78:function(e,t,n){"use strict";n.r(t);var i=n("S8bZ"),r=n.n(i),o=n("jknM"),a=n("V68o"),s={components:{ErrorPageRender:r.a},props:{params:Object},data:function(){return{errorMessage:null,error:null}},created:function(){var e=this;try{Object(o.setupTextarea)(this.params)}catch(n){var t;t="TEXTAREA_NOT_FOUND"===n.code?Object(a.langString)("error_textarea_not_found","editor_weka"):Object(a.langString)("error_failed_to_initialise","editor_weka"),Object(a.loadLangStrings)([t]).then((function(){e.errorMessage=t.toString(),e.error=n}))}}},u=n("KHd+"),c=Object(u.a)(s,(function(){var e=this.$createElement,t=this._self._c||e;return this.errorMessage?t("ErrorPageRender",{attrs:{message:this.errorMessage,error:this.error}}):this._e()}),[],!1,null,null,null);c.options.__hasBlocks={script:!0,template:!0};t.default=c.exports},pynp:function(e,t){e.exports=tui.require("tui/polyfills/ResizeObserver")},r4xq:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/NodeBar")},rqBY:function(e,t){e.exports=tui.require("tui/components/json_editor/nodes/Mention")},sXyB:function(e,t,n){var i=n("SksO"),r=n("b48C");function o(t,n,a){return r()?e.exports=o=Reflect.construct:e.exports=o=function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&i(o,n.prototype),o},o.apply(null,arguments)}e.exports=o},sxi1:function(e,t){e.exports=tui.require("tui/components/icons/More")},ta2K:function(e,t){e.exports=tui.require("editor_weka/components/nodes/VideoBlock")},tkAW:function(e,t){e.exports=tui.require("tui/components/modal/Modal")},tnXT:function(e,t){e.exports=tui.require("editor_weka/components/nodes/BaseNode")},u5iS:function(e,t){e.exports=tui.require("tui/components/modal/ModalContent")},ulH4:function(e,t){e.exports=tui.require("ext_prosemirror/dropcursor")},"v+xu":function(e,t){e.exports=tui.require("ext_prosemirror/inputrules")},vF5l:function(e,t){e.exports=tui.require("tui/components/buttons/Button")},vFxO:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var i=n("J4zp"),r=n.n(i),o=n("lwsE"),a=n.n(o),s=n("W8MJ"),u=n.n(s),c=n("i7/w"),l=n.n(c),d=n("1egj"),f=function(){function e(t,n){var i=n.editor,r=n.node,o=n.view,s=n.getPos,u=n.parent,c=n.context;a()(this,e),this.component=t,this.editor=i,this.node=r,this.view=o,this.parent=u,this.context=c,this.isNode=!!this.node.marks,this.isMark=!this.isNode,this.getPos=this.isNode?s:null,this.createVue(),this.dom=this.vm.$el,this.contentDOM=this.vm.$refs.content}return u()(e,[{key:"createVue",value:function(){var e=this,t=l.a.extend(this.component),n={nodeInfo:this.getNodeInfo(),contextInfo:this.getContextInfo(),updateAttrs:function(t){return e.updateAttrs(t)},replaceWith:function(t){return e.replaceWith(t)},getPos:this.getPos,getRange:this.getRange.bind(this)};this.vm=new t({parent:this.parent,propsData:n}).$mount(),this.vm.$on("remove",this.remove.bind(this))}},{key:"getNodeInfo",value:function(){var e={node:this.node,editor:this.editor};return Object.preventExtensions(e),e}},{key:"getContextInfo",value:function(){var e={context:this.context};return Object.preventExtensions(e),e}},{key:"update",value:function(e,t){return e.type===this.node.type&&(e===this.node&&this.decorations===t||(this.node=e,this.updateComponentProps({nodeInfo:this.getNodeInfo()})),!0)}},{key:"updateComponentProps",value:function(e){var t=this;if(this.vm._props){var n=l.a.config.silent;l.a.config.silent=!0,Object.entries(e).forEach((function(e){var n=r()(e,2),i=n[0],o=n[1];t.vm._props[i]=o})),l.a.config.silent=n}}},{key:"updateAttrs",value:function(e){if(this.view.editable){var t=this.view.state,n=this.node.type,i=this.getPos(),r=Object.assign({},this.node.attrs,e),o=this.isMark?t.tr.removeMark(i.from,i.to,n).addMark(i.from,i.to,n.create(r)):t.tr.setNodeMarkup(i,null,r);this.view.dispatch(o)}}},{key:"replaceWith",value:function(e){var t=e(this.view.state.schema);if(void 0!==t){var n=this.getRange(),i=this.view.state.tr.replaceWith(n.from,n.to,t);this.view.dispatch(i)}}},{key:"remove",value:function(){var e=this.view.state.tr,t=this.getRange(),n=e.delete(t.from,t.to);this.view.dispatch(n)}},{key:"getSize",value:function(){return this.node.nodeSize}},{key:"getRange",value:function(){if(this.isNode){var e=this.getPos();return{from:e,to:e+this.getSize()}}if(this.isMark){var t=this.view.posAtDOM(this.dom),n=this.view.state.doc.resolve(t);return Object(d.getMarkRange)(n,this.node.type)}}},{key:"destroy",value:function(){this.vm.$destroy()}}]),e}()},vyVp:function(e,t){e.exports=tui.require("tui/notifications")},w4Gt:function(e,t,n){"use strict";n.r(t);var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("7W2i"),f=n.n(d),p=n("a1gu"),m=n.n(p),h=n("Nsbk"),v=n.n(h),k=n("zJMb"),g=n("ziKp"),_=n.n(g),y=n("6RS6"),b=n.n(y),x=n("2RJX"),w=n.n(x),N=n("cy56"),O=n("V68o"),S=n("LAEe"),I=n("b7+R"),j=n("GcJT"),T=n("KY8K"),A=n("vyVp");function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m()(this,n)}}var $=function(e){f()(i,e);var t,n=E(i);function i(e){var t;return u()(this,i),t=n.call(this,e),void 0===e&&(e={}),t.acceptTypes=e.accepttypes||[],t}return l()(i,[{key:"nodes",value:function(){return{attachment:{schema:{inline:!0,atom:!0,attrs:{filename:{default:void 0},size:{default:void 0},option:{default:void 0},url:{default:void 0}},parseDOM:[{tag:"div.tui-wekaNodeAttachment",getAttrs:I.getJsonAttrs}],toDOM:function(e){return["div",{class:"tui-wekaNodeAttachment","data-attrs":JSON.stringify({filename:e.attrs.filename,option:e.attrs.option,url:e.attrs.url})}]}},component:_.a,componentContext:{convertToImage:this._convertToImage.bind(this),convertToVideo:this._convertToVideo.bind(this),convertToAudio:this._convertToAudio.bind(this),updateNode:this._updateNode.bind(this),hasImageNode:this._hasImageNode.bind(this),hasVideoNode:this._hasVideoNode.bind(this),removeNode:this.removeNode.bind(this),hasAudioNode:this._hasAudioNode.bind(this),getFileUrl:this._getFileUrl.bind(this),getItemId:this._getItemId.bind(this)}},attachments:{schema:{group:"block",allowGapCursor:!0,content:"attachment*",parseDOM:[{tag:"div.tui-wekaNodeAttachments"}],toDOM:function(){return["div",{class:"tui-wekaNodeAttachments"},0]}},component:b.a}}}},{key:"toolbarItems",value:function(){var e=this;return this.editor.fileStorage.enabled?[new N.ToolbarItem({group:"embeds",label:Object(O.langString)("attachment","editor_weka"),iconComponent:w.a,execute:function(t){Object(T.pickFiles)(t).then((function(t){e.startUploadingFiles(t)}))}})]:[]}},{key:"plugins",value:function(){return this.editor.fileStorage.enabled?[Object(S.attachment)({onDrop:this._onDropEvent.bind(this),onKeyDown:this._onKeyDownEvent.bind(this)})]:[]}},{key:"_findAttachmentCollectionBlock",value:function(e){var t=e.selection.$from,n=t.parent;if(!n||"attachments"!==n.type.name)return null;var i=t.pos;return e.selection.empty||(i+=1),{from:t.before(),to:t.after(),insertPoint:i,node:n}}},{key:"startUploadingFiles",value:(t=a()(r.a.mark((function e(t){var n,i,o,a,s,u,c,l,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.editor.fileStorage.uploadFiles(t,this.acceptTypes);case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return");case 6:i=this.editor.state.schema,o=this.editor.view,a=o.state.tr,s=this._findAttachmentCollectionBlock(a),u=n.map((function(e){var t=e.file,n=e.url,r=e.size;return i.node("attachment",{filename:t,url:n,size:r,option:{}})})),s?(a.insert(s.insertPoint,u),o.dispatch(a)):(c=i.node("attachments",null,u),l=a.selection.$from.pos,o.dispatch(a.replaceWith(l,l,c))),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0),d=Object(O.langString)("error_upload_failed","editor_weka"),Object(O.loadLangStrings)([d]).then((function(){return Object(A.notify)({type:"error",message:d.toString()})}));case 17:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e){return t.apply(this,arguments)})},{key:"_onKeyDownEvent",value:function(e){var t=e.view,n=e.event,i=t.state.tr,r=this._findAttachmentCollectionBlock(i);if(!r)return!1;if("Enter"===n.key){var o=t.state.schema.nodes.paragraph.createAndFill();return i.insert(r.to,o),i.setSelection(new j.TextSelection(i.doc.resolve(r.to+1))),t.dispatch(i),!0}if("Backspace"===n.key){if(!i.selection.$from.nodeBefore)return!1;if(1===r.node.content.size)return i.delete(r.from,r.to),t.dispatch(i),!0}return!1}},{key:"_onDropEvent",value:function(e){var t=e.event;return!!(t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length)&&(t.preventDefault(),this.startUploadingFiles(t.dataTransfer.files),!0)}},{key:"_convertToImage",value:function(e,t){var n=this,i=t.filename,r=t.alttext;this.editor.execute((function(t,o){var a=t.schema.node("image",{filename:i,url:n._getFileUrl(i),alttext:r});n._doConvertToMedia(a,t.tr,o,e)}))}},{key:"_convertToVideo",value:function(e,t){var n=this,i=t.filename,r=t.mimeType;this.editor.execute((function(t,o){var a=t.schema.node("video",{filename:i,url:n._getFileUrl(i),mime_type:r});n._doConvertToMedia(a,t.tr,o,e)}))}},{key:"_updateNode",value:function(e,t){var n=this,i=t.filename,r=t.option,o=t.size;this.editor.execute((function(t,a){var s=t.tr,u=e();a(s.replaceWith(u.from,u.to,t.schema.node("attachment",{filename:i,url:n._getFileUrl(i),option:r,size:o}))),n.editor.view.focus()}))}},{key:"_hasImageNode",value:function(){return this.editor.hasNode("image")}},{key:"_hasVideoNode",value:function(){return this.editor.hasNode("video")}},{key:"_hasAudioNode",value:function(){return this.editor.hasNode("audio")}},{key:"removeNode",value:function(e){var t=this;this.editor.execute((function(n,i){var r=n.tr,o=t._findAttachmentCollectionBlock(r);if(1===o.node.content.size)r.delete(o.from,o.to);else{var a=e();r.delete(a.from,a.to)}i(r)}))}},{key:"_convertToAudio",value:function(e,t){var n=this,i=t.filename,r=t.mimeType;this.editor.execute((function(t,o){var a=t.schema.node("audio",{filename:i,url:n._getFileUrl(i),mime_type:r});n._doConvertToMedia(a,t.tr,o,e)}))}},{key:"_doConvertToMedia",value:function(e,t,n,i){var r=this._findAttachmentCollectionBlock(t);if(r){if(t.insert(r.to,e),1===r.node.content.size)t.delete(r.from,r.to);else{var o=i();t.delete(o.from,o.to)}n(t)}}},{key:"_getFileUrl",value:function(e){var t=this.editor.fileStorage.getFile(e);return null===t?null:t.url}},{key:"_getItemId",value:function(){return this.editor.fileStorage.getFileStorageItemId()}}]),i}(k.default);t.default=function(e){return new $(e)}},w52A:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=(n("GcJT"),n("kS2v")),u=function(){function e(){r()(this,e),this._editor=null,this._state=null,this._doc=null,this._html=null,this._map=null,Object.preventExtensions(this)}return a()(e,[{key:"inflated",value:function(e){return this._editor==e||this._map&&!!this._map[e.uid]}},{key:"inflate",value:function(e,t){this._editor?(this._map||(this._map={}),this._map[e.uid]=t):(this._editor=e,this._state=t)}},{key:"getState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?this._editor===e?this._state:this._map&&this._map[e.uid]?this._map[e.uid]:null:this._state}},{key:"getDoc",value:function(){return this._doc||(this._doc=this._state.toJSON().doc),this._doc}},{key:"hasHtml",value:function(){return!!this._html}},{key:"getHtml",value:function(){return this._html}},{key:"isEmpty",get:function(){if(this._state){var e=this._state.doc;return 0===e.childCount||1===e.childCount&&e.firstChild.isTextblock&&0===e.firstChild.content.size}if(this._doc){if(0===c(this._doc))return!0;if(1===c(this._doc)){var t=this._doc.content[0];return"paragraph"==t.type&&0===c(t)}return!1}return!0}},{key:"fileStorageItemId",get:function(){return this._editor?this._editor.getFileStorageItemId():null}}],[{key:"fromState",value:function(t,n){var i=new e;return i._editor=n,i._state=t,i}},{key:"fromDoc",value:function(t){var n=new e;return n._doc=t,n}},{key:"fromHtml",value:function(t){var n=new e;return n._html=t,n}},{key:"empty",value:function(){return e.fromDoc(Object(s.getDefaultDocument)())}}]),e}();function c(e){return e&&e.content?e.content.length:0}},wC1v:function(e,t){},wTVA:function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},wkBT:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},wq8e:function(e,t){e.exports=tui.require("tui/dom/scroll")},xSMd:function(e,t){},xfeJ:function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},yHzl:function(e,t){e.exports=tui.require("editor_weka/components/editing/EditImageAltTextModal")},yXPU:function(e,t){function n(e,t,n,i,r,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,r)}e.exports=function(e){return function(){var t=this,i=arguments;return new Promise((function(r,o){var a=e.apply(t,i);function s(e){n(a,r,o,s,u,"next",e)}function u(e){n(a,r,o,s,u,"throw",e)}s(void 0)}))}}},yrzs:function(e,t){e.exports=tui.require("tui/components/icons/TextBold")},ywTm:function(e,t,n){"use strict";n.r(t);var i=n("tnXT"),r=n.n(i),o=n("AL+t"),a=n.n(o),s=n("hg2Q"),u=n("r4xq"),c=n.n(u),l={components:{CoreVideoBlock:a.a,NodeBar:c.a},extends:r.a,apollo:{file:{query:s.a,variables:function(){return{item_id:this.itemId,filename:this.filename}}}},data:function(){return{file:{}}},computed:{hasAttachmentNode:function(){return!!this.context.hasAttachmentNode&&this.context.hasAttachmentNode()},actions:function(){var e=this,t=[];return this.hasAttachmentNode&&t.push({label:this.$str("display_as_attachment","editor_weka"),action:function(){e.$_toAttachment()}}),t=t.concat([{label:this.$str("remove","core"),action:function(){e.$_removeNode()}}]),this.downloadUrl&&t.push({label:this.$str("download","core"),action:function(){window.document.location.href=e.downloadUrl}}),t},itemId:function(){if(!this.context.getItemId)throw new Error("No function 'getItemId' was found from extension");return this.context.getItemId()},filename:function(){return this.attrs.filename?this.attrs.filename:null},downloadUrl:function(){return this.context.getFileUrl?this.context.getFileUrl(this.filename):null}},methods:{$_toAttachment:function(){if(this.context.replaceWithAttachment){var e={filename:this.filename,size:this.file.file_size};this.context.replaceWithAttachment(this.getRange,e)}},$_removeNode:function(){this.context.removeNode&&this.context.removeNode(this.getRange)}}},d=(n("lqaC"),n("KHd+")),f=function(e){e.options.__langStrings={core:["loadinghelp","remove","download"],editor_weka:["display_as_attachment","actions_menu_for"]}},p=Object(d.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tui-wekaVideoBlock"},[e.$apollo.loading?[n("p",[e._v("\n      "+e._s(e.$str("loadinghelp","core"))+"\n    ")])]:[n("div",{staticClass:"tui-wekaVideoBlock__inner"},[n("CoreVideoBlock",{attrs:{"mime-type":e.file.mime_type,url:e.file.url,filename:e.filename}}),e._v(" "),n("NodeBar",{attrs:{actions:e.actions,"aria-label":e.$str("actions_menu_for","editor_weka",e.filename)}})],1)]],2)}),[],!1,null,null,null);"function"==typeof f&&f(p),p.options.__hasBlocks={script:!0,template:!0};t.default=p.exports},z2s3:function(e,t){e.exports=tui.require("editor_weka/components/toolbar/Toolbar")},zJMb:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return w}));var i=n("o0o1"),r=n.n(i),o=n("yXPU"),a=n.n(o),s=n("lwsE"),u=n.n(s),c=n("W8MJ"),l=n.n(c),d=n("i7/w"),f=n.n(d),p=n("H/tB"),m=n.n(p),h=n("Mnur"),v=n.n(h),k=n("OWva"),g=n.n(k),_=(n("/7YT"),n("5vO2"),n("V68o")),y=n("TGM/"),b=n.n(y),x=function(e){var t=b()("sleep");return new Promise((function(n){return setTimeout((function(){t(),n()}),e)}))},w=function(){function e(t){u()(this,e),this.editor=null,this.options=Object.assign({},t)}var t,n;return l()(e,[{key:"setEditor",value:function(e){this.editor=e}},{key:"nodes",value:function(){return[]}},{key:"marks",value:function(){return[]}},{key:"plugins",value:function(){return[]}},{key:"toolbarItems",value:function(){return[]}},{key:"keymap",value:function(e){}},{key:"inputRules",value:function(){return[]}},{key:"getSchema",value:function(){return this.editor.schema}},{key:"showModal",value:(n=a()(r.a.mark((function e(t,n){var i,o,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=document.createElement("span"),this.editor.viewExtrasEl.appendChild(i),o={component:t,props:n},Object.preventExtensions(o),e.next=6,m.a.loadRequirements(t);case 6:return(a=new N({parent:this.editor.getParent(),propsData:{container:o}})).$mount(i),e.abrupt("return",new Promise((function(e){a.$on("close-complete",(function(t){a.$destroy(),e(t)})),a.show()})));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"showComponent",value:function(e,t){var n=document.createElement("span"),i=f.a.extend(e);this.editor.viewExtrasEl.appendChild(n);var r=new i(Object.assign({parent:this.editor.getParent()},t));return r.$mount(n),r}},{key:"showActionDropdown",value:(t=a()(r.a.mark((function e(t,n){var i,o,a,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.actions,o=this.editor.view.coordsAtPos(t),a=this.editor.viewExtrasEl.offsetParent.getBoundingClientRect(),e.next=5,x(0);case 5:return e.next=7,Object(_.loadLangStrings)(i.map((function(e){return e.label})));case 7:return(s=this.showComponent(g.a,{propsData:{location:{x:o.left-a.left,y:o.bottom-a.top},actions:i}})).$on("dismiss",(function(){s.$destroy(),s.$el.remove()})),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"removeNode",value:function(e){this.editor.execute((function(t,n){var i=t.tr,r=e();i.delete(r.from,r.to),n(i)}))}},{key:"doc",get:function(){return this.editor.state.doc}}]),e}(),N=f.a.extend({props:{container:{type:Object}},data:function(){return{result:null,open:!1}},methods:{show:function(){this.open=!0},requestClose:function(e){this.result=e,this.open=!1},closeComplete:function(){this.$emit("close-complete",this.result)}},render:function(e){return e(v.a,{props:{open:this.open},on:{"request-close":this.requestClose,"close-complete":this.closeComplete}},[e(this.container.component,{props:this.container.props})])}})},zK61:function(e,t){e.exports=tui.require("editor_weka/mixins/attachment_mixin")},zPke:function(e,t,n){"use strict";n.r(t);var i=n("lwsE"),r=n.n(i),o=n("W8MJ"),a=n.n(o),s=n("7W2i"),u=n.n(s),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),f=n.n(d),p=n("zJMb"),m=n("cy56"),h=n("V68o"),v=n("Z5hI"),k=n.n(v);function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=f()(e);if(t){var r=f()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var _=function(e){u()(n,e);var t=g(n);function n(){return r()(this,n),t.apply(this,arguments)}return a()(n,[{key:"nodes",value:function(){return{ruler:{schema:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function(){return["hr"]}}}}}},{key:"toolbarItems",value:function(){return[new m.ToolbarItem({group:"embeds",label:Object(h.langString)("horizontalrule","editor"),iconComponent:k.a,execute:function(e){e.execute((function(t,n){var i=t.schema.nodes.ruler;n(t.tr.replaceSelectionWith(i.create())),e.view.focus()}))}})]}},{key:"keymap",value:function(e){var t=this.getSchema().nodes.ruler;e("Mod-_",(function(e,n){return n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0}))}}]),n}(p.default);t.default=function(e){return new _(e)}},zTcH:function(e,t){e.exports=tui.require("ext_prosemirror/commands")},ziKp:function(e,t){e.exports=tui.require("editor_weka/components/nodes/Attachment")},zyVY:function(e,t){e.exports=tui.require("tui/components/icons/Emoji")}});