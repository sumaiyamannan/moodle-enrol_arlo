define(["core/str"],function(a){function b(b){h&&b.data.sender&&"auth_callback"===b.data.sender&&("success"===b.data.status?c(f.value):a.get_string("connectionfailed","mod_facetoface").then(function(a){document.querySelector(".mod_facetoface-connected").innerText=a}),h.close())}function c(b){M.util.js_pending("nod_facetoface-room_integration-oauth_confirmation"),new Promise(function(a){require(["core/ajax"],a)}).then(function(a){return a.call([{methodname:"mod_facetoface_user_profile",args:{plugin:b}}])[0]}).then(function(b){return b.name?a.get_string("connectedas","mod_facetoface",b.name):Promise.resolve("")}).then(function(a){document.querySelector(".mod_facetoface-connected").innerText=a})["catch"](function(){document.querySelector(".mod_facetoface-connected").innerText="",M.util.js_complete("nod_facetoface-room_integration-oauth_confirmation")})}function d(){var a=document.querySelector("[name="+f.value+"_auth_endpoint]");h&&h.close(),a?(g.disabled=!1,c(f.value)):g.disabled=!0}function e(a){if(!g.disabled){a.preventDefault();var b=document.querySelector("[name="+f.value+"_auth_endpoint]");!b||h&&!h.closed||(h=window.open(b.value,"_blank","width=400,height=500,opener"))}}var f,g,h=null;return{init:function(){f=document.getElementById("id_plugin"),g=document.getElementById("show-authorise-dialog"),g.disabled=!0,d(),f.removeEventListener("change",d),f.addEventListener("change",d),g.removeEventListener("click",e),g.addEventListener("click",e),window.removeEventListener("message",b),window.addEventListener("message",b)}}});